{
  "openapi": "3.0.0",
  "info": {
    "title": "CarbonTrack API",
    "version": "1.0.0",
    "description": "CarbonTrack碳足迹追踪应用的完整API文档。包含用户认证、碳活动计算、积分系统、消息管理等核心功能。所有API都支持幂等性、审计日志和安全验证。",
    "contact": {
      "name": "CarbonTrack Development Team",
      "email": "dev@carbontrack.com"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "x-middleware": {
    "description": "API中间件说明",
    "auth": {
      "description": "JWT认证中间件，验证Authorization头中的Bearer token",
      "headers": [
        "Authorization: Bearer {token}"
      ],
      "error_codes": [
        "UNAUTHORIZED",
        "TOKEN_EXPIRED",
        "INVALID_TOKEN"
      ]
    },
    "admin": {
      "description": "管理员权限中间件，验证用户是否具有管理员权限",
      "error_codes": [
        "AUTH_REQUIRED",
        "ADMIN_REQUIRED",
        "ACCESS_DENIED"
      ]
    },
    "turnstile": {
      "description": "Cloudflare Turnstile机器人验证中间件，保护敏感操作",
      "required_routes": [
        "/auth/register",
        "/auth/login",
        "/auth/send-verification-code",
        "/auth/verify-email"
      ]
    }
  },
  "paths": {
    "/auth/register": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Register User",
        "description": "Creates a new user account and dispatches an email verification message.",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User registered successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegisterSuccessResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid registration payload",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "Username or email already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "User Login",
        "description": "Authenticates a user with either email or username and password.",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginSuccessResponse"
                }
              }
            }
          },
          "400": {
            "description": "Missing credentials",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid credentials",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Logout",
        "description": "Invalidates the current session token.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Logout successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Logout successful" }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/forgot-password": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Request Password Reset",
        "description": "Triggers a password reset email if the account exists.",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email"],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Registered email address"
                  },
                  "cf_turnstile_response": {
                    "type": "string",
                    "description": "Optional Cloudflare Turnstile token"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Reset email dispatched (if account exists)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "If the email exists, a password reset link has been sent" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid email or Turnstile token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/send-verification-code": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Send Verification Code",
        "description": "Sends an email verification code to the supplied address. Requests must include a Cloudflare Turnstile token to mitigate abuse.",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [\n                  "email",\n                  "cf_turnstile_response"\n                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email address that should receive the verification code"
                  },
                  "cf_turnstile_response": {
                    "type": "string",
                    "description": "Cloudflare Turnstile token returned from the client-side human verification widget"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Verification email dispatched or already verified",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "verification_expires_at": {
                          "type": "string",
                          "format": "date-time",
                          "nullable": true
                        },
                        "verification_resend_available_at": {
                          "type": "string",
                          "format": "date-time",
                          "nullable": true
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "429": {
            "description": "Verification requests are temporarily rate limited",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/reset-password": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Reset Password",
        "description": "Completes the password reset process using the emailed token.",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["token", "password", "confirm_password"],
                "properties": {
                  "token": {
                    "type": "string",
                    "description": "Password reset token from email"
                  },
                  "password": {
                    "type": "string",
                    "format": "password",
                    "description": "New password"
                  },
                  "confirm_password": {
                    "type": "string",
                    "format": "password",
                    "description": "Confirmation of the new password"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password reset successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Password reset successfully" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid token or mismatched passwords",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/verify-email": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Verify Email",
        "description": "Verifies a user's email address by providing either the verification token or the original email plus code. Manual verification requests must include a Cloudflare Turnstile token.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "token": {
                    "type": "string",
                    "description": "Verification token included in the email link"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email address used during registration (required when verifying with a code)"
                  },
                  "code": {
                    "type": "string",
                    "description": "Verification code sent to the email address"
                  }
                },
                "anyOf": [
                  { "required": ["token"] },
                  { "required": ["email", "code"] }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Email verified successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Email verified successfully" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid token or verification code",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "429": {
            "description": "Too many invalid verification attempts",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/change-password": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Change Password",
        "description": "Allows authenticated users to change their password.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["current_password", "new_password", "confirm_password"],
                "properties": {
                  "current_password": {
                    "type": "string",
                    "format": "password",
                    "description": "Existing password"
                  },
                  "new_password": {
                    "type": "string",
                    "format": "password",
                    "description": "Desired new password"
                  },
                  "confirm_password": {
                    "type": "string",
                    "format": "password",
                    "description": "Confirmation of the new password"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password changed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Password changed successfully" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid current password or mismatched confirmation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/me": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "获取当前用户信息",
        "description": "获取当前认证用户的详细信息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取用户信息",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "User"
        ],
        "summary": "更新当前用户基本信息",
        "description": "更新当前认证用户的基本信息，如用户名、邮箱等。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string",
                    "minLength": 3,
                    "maxLength": 50,
                    "pattern": "^[a-zA-Z0-9_]+$",
                    "description": "用户名，只能包含字母、数字和下划线"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "有效的邮箱地址"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "用户信息更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "冲突（如用户名或邮箱已存在）",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/{id}": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "获取指定用户信息",
        "description": "获取指定ID用户的详细信息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "用户ID"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取用户信息",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "用户不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "User"
        ],
        "summary": "更新指定用户信息",
        "description": "管理员更新指定ID用户的基本信息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "用户ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string",
                    "minLength": 3,
                    "maxLength": 50,
                    "pattern": "^[a-zA-Z0-9_]+$",
                    "description": "用户名，只能包含字母、数字和下划线"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "有效的邮箱地址"
                  },
                  "school_id": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "学校ID"
                  },
                  "is_admin": {
                    "type": "boolean",
                    "description": "是否为管理员"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "active",
                      "inactive",
                      "suspended"
                    ],
                    "description": "用户状态"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "用户信息更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "冲突（如用户名或邮箱已存在）",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "User"
        ],
        "summary": "删除指定用户",
        "description": "删除指定ID的用户（需要权限）。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "用户ID"
          }
        ],
        "responses": {
          "200": {
            "description": "用户删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "User deleted successfully"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "用户不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/me/profile": {
      "put": {
        "tags": [
          "User"
        ],
        "summary": "更新当前用户资料",
        "description": "更新当前认证用户的个人资料信息。支持更新学校ID和头像ID。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateProfileRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Profile updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/me/avatar": {
      "put": {
        "tags": [
          "User"
        ],
        "summary": "选择头像",
        "description": "为当前认证用户选择头像。头像ID必须是系统中存在的有效头像。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "avatar_id"
                ],
                "properties": {
                  "avatar_id": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "头像ID，必须是有效的头像标识符"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Avatar updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "avatar_id": {
                          "type": "integer"
                        },
                        "avatar_url": {
                          "type": "string"
                        },
                        "avatar_name": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/me/notification-preferences": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "获取通知偏好",
        "description": "返回当前用户的通知类别及邮件发送偏好。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "获取成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotificationPreferencesResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "User"
        ],
        "summary": "更新通知偏好",
        "description": "更新用户邮件通知的开关设置。部分关键通知（站内信、安全提醒等）始终保持开启。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NotificationPreferenceUpdateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotificationPreferencesResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求无效",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
      }
    }
  },
    "/users/me/notification-preferences/test-email": {
      "post": {
        "tags": [
          "User"
        ],
        "summary": "发送通知测试邮件",
        "description": "根据所选通知类别发送测试邮件。优先使用用户最近的数据填充模版，若无相关数据则生成仅供测试的样本并在邮件中标注。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NotificationTestEmailRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "发送结果",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotificationTestEmailResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "请求参数无效或缺少邮箱",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "503": {
            "description": "邮件服务不可用",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/me/points-history": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "Get Points History",
        "description": "Get the points transaction history for the currently authenticated user.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PointsHistoryResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/me/stats": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "Get User Stats",
        "description": "Get statistics for the currently authenticated user.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserStatsResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/me/chart-data": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "Get Chart Data",
        "description": "Get data for charts on the user dashboard (last 30 days).",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChartDataResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/me/activities": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "Get Recent Activities",
        "description": "Get recent activities for the user dashboard.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RecentActivitiesResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of recent activities to return (1-50).",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 50,
              "default": 10
            }
          }
        ]
      }
    },
    "/avatars": {
      "get": {
        "tags": [
          "Avatar"
        ],
        "summary": "Get Avatars",
        "description": "Get a list of available avatars.",
        "parameters": [
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "include_inactive",
            "in": "query",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AvatarsResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/avatars/categories": {
      "get": {
        "tags": [
          "Avatar"
        ],
        "summary": "Get Avatar Categories",
        "description": "Get a list of avatar categories.",
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AvatarCategoriesResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-activities": {
      "get": {
        "tags": [
          "Carbon Activity"
        ],
        "summary": "Get Carbon Activities",
        "description": "Get a list of carbon activities.",
        "parameters": [
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "grouped",
            "in": "query",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CarbonActivitiesResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-activities/{id}": {
      "get": {
        "tags": [
          "Carbon Activity"
        ],
        "summary": "Get Carbon Activity",
        "description": "Get a single carbon activity by ID.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CarbonActivityResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-track/calculate": {
      "post": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "Calculate Carbon Savings",
        "description": "Calculate carbon savings and points for an activity without creating a record.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CalculateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Calculation successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CalculateResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Activity not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-track/record": {
      "post": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "提交碳记录",
        "description": "提交碳减排记录供审核 (legacy 路径)。需要幂等性ID防止重复提交。为兼容旧版，该路径下 images 字段可为空数组或省略。推荐迁移到 /carbon-records。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "X-Request-ID",
            "in": "header",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-f]{16}$",
              "example": "a3f1c09e7b5d4c1a"
            },
            "description": "幂等性请求ID，16位小写十六进制 (^[0-9a-f]{16}$)，24小时内有效。旧客户端若仍发送UUID将被拒绝或忽略幂等语义。"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubmitRecordRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Record submitted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SubmitRecordResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Activity not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-records": {
      "post": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "提交碳记录 (v1)",
        "description": "提交碳减排记录 (推荐新客户端使用)。此端点要求至少提供一张 images。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "X-Request-ID",
            "in": "header",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-f]{16}$",
              "example": "b7e9a0f1c2d34e56"
            },
            "description": "幂等性请求ID，16位小写十六进制 (^[0-9a-f]{16}$)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubmitRecordRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Record submitted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SubmitRecordResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Activity not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/activities": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Track"
        ],
        "summary": "获取碳减排记录列表（管理员审核）",
        "description": "返回管理员审核所需的碳记录列表，已内联 images 可直接展示，无需再请求预签名。支持多条件筛选、分页、排序及旧字段别名。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "approved",
                "rejected",
                ""
              ]
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "activity_id",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "school_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_from",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "date_to",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "min_carbon",
            "in": "query",
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "max_carbon",
            "in": "query",
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "min_points",
            "in": "query",
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "max_points",
            "in": "query",
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 50
            }
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "created_at_asc",
                "created_at_desc"
              ]
            }
          },
          {
            "name": "sort_by",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "created_at",
                "date",
                "carbon_saved",
                "points_earned",
                "amount",
                "status"
              ]
            }
          },
          {
            "name": "order",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "ASC",
                "DESC"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminCarbonRecordsResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-track/transactions": {
      "get": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "获取用户碳记录",
        "description": "获取当前认证用户的碳减排记录列表。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "approved",
                "rejected"
              ]
            }
          },
          {
            "name": "activity_id",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取碳记录列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PointsHistoryResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-track/transactions/{id}": {
      "get": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "获取碳记录详情",
        "description": "获取指定ID的碳减排记录详情。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "碳记录ID"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取碳记录详情",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PointsHistoryResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "审核碳记录",
        "description": "管理员审核指定ID的碳减排记录（批准或拒绝）。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "碳记录ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "status"
                ],
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "approved",
                      "rejected"
                    ],
                    "description": "审核状态"
                  },
                  "admin_notes": {
                    "type": "string",
                    "description": "管理员备注，可选"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "记录审核成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Record reviewed successfully"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "删除碳记录",
        "description": "删除指定ID的碳减排记录。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "碳记录ID"
          }
        ],
        "responses": {
          "200": {
            "description": "记录删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Record deleted successfully"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-track/transactions/{id}/approve": {
      "put": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "审核通过碳记录 (别名)",
        "description": "等价于 PUT /carbon-track/transactions/{id} 并在请求体中传 status=approved。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "审核通过"
          },
          "401": {
            "description": "未授权"
          },
          "403": {
            "description": "禁止访问"
          },
          "404": {
            "description": "记录不存在"
          }
        }
      }
    },
    "/carbon-track/transactions/{id}/reject": {
      "put": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "审核拒绝碳记录 (别名)",
        "description": "等价于 PUT /carbon-track/transactions/{id} 并在请求体中传 status=rejected。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "审核拒绝"
          },
          "401": {
            "description": "未授权"
          },
          "403": {
            "description": "禁止访问"
          },
          "404": {
            "description": "记录不存在"
          }
        }
      }
    },
    "/admin/exchanges": {
      "get": {
        "tags": [
          "Admin",
          "Exchange"
        ],
        "summary": "获取兑换记录列表 (管理员)",
        "description": "管理员获取所有产品兑换记录列表。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "completed",
                "cancelled"
              ]
            }
          },
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "product_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取兑换记录列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExchangeTransactionsResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/exchanges/{id}": {
      "get": {
        "tags": [
          "Admin",
          "Exchange"
        ],
        "summary": "获取兑换记录详情 (管理员)",
        "description": "管理员获取指定ID的产品兑换记录详情。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "兑换记录ID"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取兑换记录详情",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExchangeTransactionResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "兑换记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Admin",
          "Exchange"
        ],
        "summary": "更新兑换记录状态 (别名)",
        "description": "管理员更新指定ID的产品兑换记录状态，等价于 /admin/exchanges/{id}/status。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "兑换记录ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "status"
                ],
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "pending",
                      "processing",
                      "shipped",
                      "completed",
                      "cancelled"
                    ],
                    "description": "新的状态"
                  },
                  "admin_notes": {
                    "type": "string",
                    "description": "管理员备注，可选"
                  },
                  "tracking_number": {
                    "type": "string",
                    "description": "物流单号，可选"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "兑换记录状态更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Exchange status updated successfully"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "兑换记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/exchanges/{id}/status": {
      "put": {
        "tags": [
          "Admin",
          "Exchange"
        ],
        "summary": "更新兑换记录状态",
        "description": "管理员更新指定ID的产品兑换记录状态。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "兑换记录ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "status"
                ],
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "pending",
                      "completed",
                      "cancelled"
                    ],
                    "description": "新的状态"
                  },
                  "admin_notes": {
                    "type": "string",
                    "description": "管理员备注，可选"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "兑换记录状态更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Exchange status updated successfully"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "兑换记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/products": {
      "get": {
        "tags": [
          "Admin",
          "Product"
        ],
        "summary": "获取产品列表 (管理员)",
        "description": "管理员获取产品列表，支持搜索、筛选和分页。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Category slug or name filter (slug recommended)"
          },
          {
            "name": "min_points",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "max_points",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "inactive"
              ]
            }
          },
          {
            "name": "tags",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "按标签 slug 筛选，可传入逗号分隔的多个标签"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取产品列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductsResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Admin",
          "Product"
        ],
        "summary": "创建新产品 (管理员)",
        "description": "管理员创建新的可兑换产品。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateProductRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "产品创建成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/products/{id}": {
      "put": {
        "tags": [
          "Admin",
          "Product"
        ],
        "summary": "更新产品信息 (管理员)",
        "description": "管理员更新指定ID的产品信息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "产品ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateProductRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "产品更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "产品不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Admin",
          "Product"
        ],
        "summary": "删除产品 (管理员)",
        "description": "管理员删除指定ID的产品。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "产品ID"
          }
        ],
        "responses": {
          "200": {
            "description": "产品删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Product deleted successfully"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "产品不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/avatars": {
      "get": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "获取头像列表 (管理员)",
        "description": "管理员获取所有头像列表，支持筛选和分页。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "is_active",
            "in": "query",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取头像列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AvatarsResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "创建新头像",
        "description": "管理员创建新的头像。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateAvatarRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "头像创建成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AvatarResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/avatars/{id}": {
      "get": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "获取头像详情 (管理员)",
        "description": "管理员获取指定ID的头像详细信息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "头像ID"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取头像详情",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AvatarResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "头像不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "更新头像信息",
        "description": "管理员更新指定ID的头像信息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "头像ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateAvatarRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "头像更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AvatarResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "头像不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "删除头像",
        "description": "管理员删除指定ID的头像。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "头像ID"
          }
        ],
        "responses": {
          "200": {
            "description": "头像删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Avatar deleted successfully"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "头像不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/avatars/sort-orders": {
      "put": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "更新头像排序顺序",
        "description": "管理员更新头像的排序顺序。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "sort_orders"
                ],
                "properties": {
                  "sort_orders": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "id",
                        "sort_order"
                      ],
                      "properties": {
                        "id": {
                          "type": "integer",
                          "description": "头像ID"
                        },
                        "sort_order": {
                          "type": "integer",
                          "description": "新的排序顺序"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "排序顺序更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Sort orders updated successfully"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/avatars/usage-stats": {
      "get": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "获取头像使用统计",
        "description": "管理员获取头像的使用统计信息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取统计信息",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "total_avatars": {
                          "type": "integer"
                        },
                        "active_avatars": {
                          "type": "integer"
                        },
                        "usage_counts": {
                          "type": "object",
                          "additionalProperties": {
                            "type": "integer"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/avatars/upload": {
      "post": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "上传头像文件",
        "description": "管理员上传头像文件。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "file"
                ],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "要上传的头像文件"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "文件上传成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "File uploaded successfully"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "file_path": {
                          "type": "string"
                        },
                        "file_url": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/avatars/{id}/restore": {
      "post": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "恢复头像",
        "description": "管理员恢复指定ID的已删除头像。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "头像ID"
          }
        ],
        "responses": {
          "200": {
            "description": "头像恢复成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Avatar restored successfully"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "头像不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/avatars/{id}/set-default": {
      "put": {
        "tags": [
          "Admin",
          "Avatar"
        ],
        "summary": "设置默认头像",
        "description": "管理员设置指定ID的头像为默认头像。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "头像ID"
          }
        ],
        "responses": {
          "200": {
            "description": "默认头像设置成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Default avatar set successfully"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "头像不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/upload": {
      "post": {
        "tags": [
          "File Upload"
        ],
        "summary": "上传单个文件",
        "description": "上传单个文件。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "file"
                ],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "要上传的文件"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "文件上传成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "File uploaded successfully"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "file_path": {
                          "type": "string"
                        },
                        "file_url": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/upload-multiple": {
      "post": {
        "tags": [
          "File Upload"
        ],
        "summary": "上传多个文件",
        "description": "上传多个文件。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "files"
                ],
                "properties": {
                  "files": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "binary"
                    },
                    "description": "要上传的文件数组"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "文件上传成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Files uploaded successfully"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "file_path": {
                            "type": "string"
                          },
                          "file_url": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/{path}": {
      "delete": {
        "tags": [
          "File Upload"
        ],
        "summary": "删除文件",
        "description": "删除指定路径的文件。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "文件路径"
          }
        ],
        "responses": {
          "200": {
            "description": "文件删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "File deleted successfully"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "文件不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/{path}/info": {
      "get": {
        "tags": [
          "File Upload"
        ],
        "summary": "获取文件信息",
        "description": "获取指定路径的文件信息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "文件路径"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取文件信息",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "file_name": {
                          "type": "string"
                        },
                        "file_size": {
                          "type": "integer"
                        },
                        "mime_type": {
                          "type": "string"
                        },
                        "created_at": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "文件不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/{path}/presigned-url": {
      "get": {
        "tags": [
          "File Upload"
        ],
        "summary": "生成预签名URL",
        "description": "生成指定文件的预签名URL，用于临时访问。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "文件路径"
          },
          {
            "name": "expires_in",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 600
            },
            "description": "URL有效期（秒）（默认10分钟）"
          }
        ],
        "responses": {
          "200": {
            "description": "成功生成预签名URL",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "presigned_url": {
                          "type": "string",
                          "format": "uri"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "文件不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/files": {
      "get": {
        "tags": [
          "Admin",
          "File"
        ],
        "summary": "获取文件列表 (管理员)",
        "description": "管理员获取文件列表，支持搜索、筛选和分页。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "order_by",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "name",
                "size",
                "date"
              ]
            }
          },
          {
            "name": "order_dir",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取文件列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FilesResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/files/stats": {
      "get": {
        "tags": [
          "Admin",
          "File Upload"
        ],
        "summary": "获取文件存储统计",
        "description": "管理员获取文件存储的统计信息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取统计信息",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "total_files": {
                          "type": "integer"
                        },
                        "total_size": {
                          "type": "integer"
                        },
                        "expired_files": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/files/cleanup": {
      "post": {
        "tags": [
          "Admin",
          "File Upload"
        ],
        "summary": "清理过期文件",
        "description": "管理员清理过期的临时文件。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "文件清理成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Expired files cleaned up successfully"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "cleaned_count": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/activities": {
      "get": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "获取用户碳记录 (兼容旧版)",
        "description": "获取当前认证用户的碳减排记录列表，用于向后兼容。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取碳记录列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PointsHistoryResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/activities/categories": {
      "get": {
        "tags": [
          "Carbon Activity"
        ],
        "summary": "获取碳活动分类列表 (兼容旧版)",
        "description": "获取所有可用的碳活动分类列表，用于向后兼容。",
        "responses": {
          "200": {
            "description": "成功获取碳活动分类列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/messages/mark-all-read": {
      "put": {
        "tags": [
          "Message"
        ],
        "summary": "批量标记消息为已读",
        "description": "将当前用户的所有未读消息标记为已读状态。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "批量标记成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "updated_count": {
                          "type": "integer",
                          "description": "标记为已读的消息数量"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/messages": {
      "get": {
        "tags": [
          "Message"
        ],
        "summary": "获取用户消息列表",
        "description": "获取当前认证用户的消息列表。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "is_read",
            "in": "query",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取消息列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer"
                          },
                          "title": {
                            "type": "string"
                          },
                          "content": {
                            "type": "string"
                          },
                          "is_read": {
                            "type": "boolean"
                          },
                          "created_at": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/messages/{id}": {
      "get": {
        "tags": [
          "Message"
        ],
        "summary": "获取消息详情",
        "description": "获取指定ID的消息详情。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "消息ID"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取消息详情",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "title": {
                          "type": "string"
                        },
                        "content": {
                          "type": "string"
                        },
                        "is_read": {
                          "type": "boolean"
                        },
                        "created_at": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "消息不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Message"
        ],
        "summary": "删除消息",
        "description": "删除指定ID的消息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "消息ID"
          }
        ],
        "responses": {
          "200": {
            "description": "消息删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "消息不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/messages/{id}/read": {
      "put": {
        "tags": [
          "Message"
        ],
        "summary": "标记消息为已读",
        "description": "将指定ID的消息标记为已读。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "消息ID"
          }
        ],
        "responses": {
          "200": {
            "description": "标记成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "消息不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/messages/unread-count": {
      "get": {
        "tags": [
          "Message"
        ],
        "summary": "获取未读消息数量",
        "description": "获取当前用户的未读消息数量。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取未读数量",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "unread_count": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/exchange": {
      "post": {
        "tags": [
          "Exchange"
        ],
        "summary": "兑换产品",
        "description": "提交兑换请求，从用户积分中扣除，创建兑换记录。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExchangeRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "兑换成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExchangeResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "库存不足或积分不足",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/exchange/transactions": {
      "get": {
        "tags": [
          "Exchange"
        ],
        "summary": "获取用户兑换记录",
        "description": "获取当前认证用户的兑换记录列表。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取兑换记录",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExchangeTransactionsResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/exchange/transactions/{id}": {
      "get": {
        "tags": [
          "Exchange"
        ],
        "summary": "获取兑换记录详情",
        "description": "获取指定ID的兑换记录详情。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "兑换记录ID"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取兑换详情",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExchangeTransactionResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/products": {
      "get": {
        "tags": [
          "Product"
        ],
        "summary": "获取产品列表",
        "description": "获取可兑换产品列表，支持搜索与分页。",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Category slug or name filter (slug recommended)"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "inactive"
              ]
            },
            "description": "仅管理员可用，筛选指定状态的商品"
          },
          {
            "name": "tags",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "按标签筛选，接受以逗号分隔的标签 slug 列表"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取产品列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductsResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Product"
        ],
        "summary": "创建产品",
        "description": "创建新产品（如果后端允许公共POST则保留；否则仅管理员，已在 /admin/products 记录）。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateProductRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "创建成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/products/tags": {
      "get": {
        "tags": [
          "Admin",
          "Product"
        ],
        "summary": "搜索产品标签 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "关键字，模糊匹配标签名称或 slug"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20,
              "minimum": 1,
              "maximum": 50
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取标签列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductTagListResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问，需要管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/products/tags": {
      "get": {
        "tags": [
          "Product"
        ],
        "summary": "搜索产品标签",
        "description": "根据名称或别名搜索现有的产品标签，未传 search 时返回热门标签。",
        "parameters": [
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "关键字，模糊匹配标签名称或 slug"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20,
              "minimum": 1,
              "maximum": 50
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取标签列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductTagListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/products/{id}": {
      "get": {
        "tags": [
          "Product"
        ],
        "summary": "获取产品详情",
        "description": "获取指定ID的产品详情。",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取产品详情",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            }
          },
          "404": {
            "description": "产品不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Product"
        ],
        "summary": "更新产品",
        "description": "更新指定ID产品（如果允许普通用户；否则仅管理员路径生效）。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateProductRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            }
          },
          "404": {
            "description": "产品不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Product"
        ],
        "summary": "删除产品",
        "description": "删除指定ID产品（如果允许普通用户；否则仅管理员路径生效）。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "删除成功"
          },
          "404": {
            "description": "产品不存在"
          }
        }
      }
    },
    "/products/categories": {
      "get": {
        "tags": [
          "Product"
        ],
        "summary": "获取产品分类",
        "description": "获取所有可用产品分类。",
        "responses": {
          "200": {
            "description": "分类加载成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "categories": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/ProductCategorySummary"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Fuzzy match category name or slug"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 5,
              "maximum": 100,
              "default": 50
            },
            "description": "Maximum number of categories to return"
          }
        ]
      }
    },
    "/schools": {
      "get": {
        "tags": [
          "School"
        ],
        "summary": "获取学校列表",
        "description": "获取学校列表（公开接口）。",
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer"
                          },
                          "name": {
                            "type": "string"
                          }
                        },
                        "generated_at": {
                          "type": "string",
                          "format": "date-time",
                          "example": "2025-10-21T12:30:00Z"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/schools": {
      "post": {
        "tags": [
          "Admin",
          "School"
        ],
        "summary": "创建学校 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "创建成功"
          }
        }
      }
    },
    "/admin/schools/{id}": {
      "put": {
        "tags": [
          "Admin",
          "School"
        ],
        "summary": "更新学校 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新成功"
          },
          "404": {
            "description": "学校不存在"
          }
        }
      },
      "delete": {
        "tags": [
          "Admin",
          "School"
        ],
        "summary": "删除学校 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "删除成功"
          },
          "404": {
            "description": "学校不存在"
          }
        }
      }
    },
    "/admin/users": {
      "get": {
        "tags": [
          "Admin",
          "User"
        ],
        "summary": "��ȡ�û��б� (����Ա)",
        "description": "����Ա��ȡ�û��б���֧�ַ�ҳɸѡ��",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "search",
            "in": "query",
            "description": "Fuzzy match on username or email. Alias: q.",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "Filter by account status",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "inactive"
              ]
            }
          },
          {
            "name": "role",
            "in": "query",
            "description": "Convenience filter. When set to admin/user it maps to is_admin=1/0.",
            "schema": {
              "type": "string",
              "enum": [
                "admin",
                "user"
              ]
            }
          },
          {
            "name": "is_admin",
            "in": "query",
            "description": "Explicit admin filter (0 or 1).",
            "schema": {
              "type": "integer",
              "enum": [
                0,
                1
              ]
            }
          },
          {
            "name": "school_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "sort",
            "in": "query",
            "description": "Sort field",
            "schema": {
              "type": "string",
              "enum": [
                "username_asc",
                "username_desc",
                "email_asc",
                "email_desc",
                "points_asc",
                "points_desc",
                "created_at_asc",
                "created_at_desc"
              ],
              "default": "created_at_desc"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "�ɹ�",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "users": {
                          "type": "array",
                          "items": {
                            "": "#/components/schemas/UserResponse"
                          }
                        },
                        "pagination": {
                          "type": "object",
                          "properties": {
                            "current_page": {
                              "type": "integer"
                            },
                            "per_page": {
                              "type": "integer"
                            },
                            "total_items": {
                              "type": "integer"
                            },
                            "total_pages": {
                              "type": "integer"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/users/{id}": {
      "put": {
        "tags": [
          "Admin",
          "User"
        ],
        "summary": "更新用户 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功"
          },
          "404": {
            "description": "用户不存在"
          }
        }
      },
      "delete": {
        "tags": [
          "Admin",
          "User"
        ],
        "summary": "删除用户 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          },
          "404": {
            "description": "用户不存在"
          }
        }
      }
    },
    "/admin/transactions/pending": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Track"
        ],
        "summary": "获取待审核碳记录 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/stats": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "获取后台统计 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "success",
                    "data"
                  ],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "required": [
                        "users",
                        "transactions",
                        "exchanges",
                        "messages",
                        "activities",
                        "carbon",
                        "trends",
                        "trend_summary",
                        "recent",
                        "generated_at"
                      ],
                      "properties": {
                        "users": {
                          "type": "object",
                          "properties": {
                            "total_users": {
                              "type": "integer",
                              "example": 128
                            },
                            "active_users": {
                              "type": "integer",
                              "example": 86
                            },
                            "inactive_users": {
                              "type": "integer",
                              "example": 42
                            },
                            "new_users_30d": {
                              "type": "integer",
                              "example": 12
                            },
                            "active_ratio": {
                              "type": "number",
                              "format": "float",
                              "example": 0.67
                            },
                            "new_users_ratio": {
                              "type": "number",
                              "format": "float",
                              "example": 0.09
                            }
                          }
                        },
                        "transactions": {
                          "type": "object",
                          "properties": {
                            "total_transactions": {
                              "type": "integer",
                              "example": 240
                            },
                            "pending_transactions": {
                              "type": "integer",
                              "example": 6
                            },
                            "approved_transactions": {
                              "type": "integer",
                              "example": 220
                            },
                            "rejected_transactions": {
                              "type": "integer",
                              "example": 14
                            },
                            "total_points_awarded": {
                              "type": "number",
                              "format": "float",
                              "example": 1840
                            },
                            "total_carbon_saved": {
                              "type": "number",
                              "format": "float",
                              "example": 524.5
                            },
                            "approval_rate": {
                              "type": "number",
                              "format": "float",
                              "example": 0.92
                            },
                            "pending_ratio": {
                              "type": "number",
                              "format": "float",
                              "example": 0.025
                            },
                            "avg_points_per_transaction": {
                              "type": "number",
                              "format": "float",
                              "example": 8.36
                            },
                            "last7_transactions": {
                              "type": "integer",
                              "example": 34
                            },
                            "last7_points_awarded": {
                              "type": "number",
                              "format": "float",
                              "example": 278.0
                            }
                          }
                        },
                        "exchanges": {
                          "type": "object",
                          "properties": {
                            "total_exchanges": {
                              "type": "integer",
                              "example": 58
                            },
                            "pending_exchanges": {
                              "type": "integer",
                              "example": 3
                            },
                            "completed_exchanges": {
                              "type": "integer",
                              "example": 50
                            },
                            "other_exchanges": {
                              "type": "integer",
                              "example": 5
                            },
                            "total_points_spent": {
                              "type": "number",
                              "format": "float",
                              "example": 910
                            },
                            "completion_rate": {
                              "type": "number",
                              "format": "float",
                              "example": 0.86
                            }
                          }
                        },
                        "messages": {
                          "type": "object",
                          "properties": {
                            "total_messages": {
                              "type": "integer",
                              "example": 320
                            },
                            "unread_messages": {
                              "type": "integer",
                              "example": 14
                            },
                            "read_messages": {
                              "type": "integer",
                              "example": 306
                            },
                            "unread_ratio": {
                              "type": "number",
                              "format": "float",
                              "example": 0.043
                            }
                          }
                        },
                        "activities": {
                          "type": "object",
                          "properties": {
                            "total_activities": {
                              "type": "integer",
                              "example": 41
                            },
                            "active_activities": {
                              "type": "integer",
                              "example": 33
                            },
                            "inactive_activities": {
                              "type": "integer",
                              "example": 8
                            },
                            "total_records": {
                              "type": "integer",
                              "example": 0
                            },
                            "approved_records": {
                              "type": "integer",
                              "example": 0
                            },
                            "pending_records": {
                              "type": "integer",
                              "example": 0
                            },
                            "rejected_records": {
                              "type": "integer",
                              "example": 0
                            },
                            "approved_activities": {
                              "type": "integer",
                              "example": 0
                            },
                            "pending_activities": {
                              "type": "integer",
                              "example": 0
                            },
                            "rejected_activities": {
                              "type": "integer",
                              "example": 0
                            }
                          }
                        },
                        "carbon": {
                          "type": "object",
                          "properties": {
                            "total_records": {
                              "type": "integer",
                              "example": 610
                            },
                            "pending_records": {
                              "type": "integer",
                              "example": 12
                            },
                            "approved_records": {
                              "type": "integer",
                              "example": 580
                            },
                            "rejected_records": {
                              "type": "integer",
                              "example": 18
                            },
                            "total_carbon_saved": {
                              "type": "number",
                              "format": "float",
                              "example": 842.3
                            },
                            "total_points_earned": {
                              "type": "number",
                              "format": "float",
                              "example": 2740
                            },
                            "last7_carbon_saved": {
                              "type": "number",
                              "format": "float",
                              "example": 86.4
                            },
                            "last7_points_earned": {
                              "type": "number",
                              "format": "float",
                              "example": 310
                            },
                            "last7_pending_records": {
                              "type": "integer",
                              "example": 4
                            },
                            "last7_approved_records": {
                              "type": "integer",
                              "example": 52
                            },
                            "approval_rate": {
                              "type": "number",
                              "format": "float",
                              "example": 0.92
                            },
                            "average_carbon_per_record": {
                              "type": "number",
                              "format": "float",
                              "example": 1.45
                            },
                            "average_daily_carbon": {
                              "type": "number",
                              "format": "float",
                              "example": 28.08
                            }
                          }
                        },
                        "trends": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "date": {
                                "type": "string",
                                "example": "2025-09-05"
                              },
                              "transactions": {
                                "type": "integer",
                                "example": 12
                              },
                              "carbon_saved": {
                                "type": "number",
                                "format": "float",
                                "example": 15.6
                              },
                              "points_awarded": {
                                "type": "number",
                                "format": "float",
                                "example": 96
                              },
                              "approved_records": {
                                "type": "integer",
                                "example": 18
                              }
                            }
                          }
                        },
                        "trend_summary": {
                          "type": "object",
                          "properties": {
                            "carbon_last7": {
                              "type": "number",
                              "format": "float",
                              "example": 86.4
                            },
                            "carbon_prev7": {
                              "type": "number",
                              "format": "float",
                              "example": 64.1
                            },
                            "carbon_delta": {
                              "type": "number",
                              "format": "float",
                              "example": 22.3
                            },
                            "carbon_delta_rate": {
                              "type": "number",
                              "format": "float",
                              "example": 0.35
                            },
                            "transactions_last7": {
                              "type": "integer",
                              "example": 82
                            },
                            "points_last7": {
                              "type": "number",
                              "format": "float",
                              "example": 640
                            },
                            "average_daily_carbon_30d": {
                              "type": "number",
                              "format": "float",
                              "example": 28.08
                            }
                          }
                        },
                        "recent": {
                          "type": "object",
                          "properties": {
                            "pending_transactions": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string",
                                    "example": "pt_3"
                                  },
                                  "user_id": {
                                    "type": [
                                      "integer",
                                      "null"
                                    ],
                                    "example": 3
                                  },
                                  "username": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "inactive_user"
                                  },
                                  "points": {
                                    "type": "number",
                                    "format": "float",
                                    "example": 5
                                  },
                                  "status": {
                                    "type": "string",
                                    "example": "pending"
                                  },
                                  "created_at": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "2025-09-28 10:15:00"
                                  }
                                }
                              }
                            },
                            "pending_carbon_records": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string",
                                    "example": "cr_3"
                                  },
                                  "user_id": {
                                    "type": [
                                      "integer",
                                      "null"
                                    ],
                                    "example": 3
                                  },
                                  "username": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "inactive_user"
                                  },
                                  "activity_id": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "act_c"
                                  },
                                  "activity_name_zh": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "活动C"
                                  },
                                  "activity_name_en": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "Activity C"
                                  },
                                  "carbon_saved": {
                                    "type": "number",
                                    "format": "float",
                                    "example": 1.0
                                  },
                                  "points_earned": {
                                    "type": "number",
                                    "format": "float",
                                    "example": 0
                                  },
                                  "created_at": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "2025-09-28 09:30:00"
                                  }
                                }
                              }
                            },
                            "latest_users": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "example": 4
                                  },
                                  "username": {
                                    "type": "string",
                                    "example": "suspended_user"
                                  },
                                  "email": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "suspended@example.com"
                                  },
                                  "status": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "suspended"
                                  },
                                  "created_at": {
                                    "type": [
                                      "string",
                                      "null"
                                    ],
                                    "example": "2025-09-27 12:50:00"
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/stats/summary": {
      "get": {
        "tags": [
          "Stats"
        ],
        "summary": "Get public community statistics",
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "success",
                    "data"
                  ],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "required": [
                        "generated_at",
                        "total_users",
                        "total_records",
                        "total_carbon_saved",
                        "total_points_awarded"
                      ],
                      "properties": {
                        "generated_at": {
                          "type": "string",
                          "format": "date-time",
                          "example": "2025-10-21T12:30:00Z"
                        },
                        "total_users": {
                          "type": "integer",
                          "example": 2048
                        },
                        "active_users": {
                          "type": "integer",
                          "example": 1580
                        },
                        "new_users_30d": {
                          "type": "integer",
                          "example": 120
                        },
                        "total_records": {
                          "type": "integer",
                          "example": 45210
                        },
                        "approved_records": {
                          "type": "integer",
                          "example": 43000
                        },
                        "pending_records": {
                          "type": "integer",
                          "example": 210
                        },
                        "total_carbon_saved": {
                          "type": "number",
                          "format": "float",
                          "example": 12654.4
                        },
                        "average_daily_carbon_30d": {
                          "type": "number",
                          "format": "float",
                          "example": 420.3
                        },
                        "carbon_last7": {
                          "type": "number",
                          "format": "float",
                          "example": 315.8
                        },
                        "total_points_awarded": {
                          "type": "number",
                          "format": "float",
                          "example": 982340
                        },
                        "transactions_last7": {
                          "type": "integer",
                          "example": 640
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/logs": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "获取系统日志 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/system-logs": {
      "get": {
        "tags": [
          "Admin",
          "Logs"
        ],
        "summary": "系统请求日志列表",
        "description": "分页返回 system_logs（请求追踪日志）。支持按 request_id / user_id / method / status_code / path / date 范围过滤。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20,
              "maximum": 200
            }
          },
          {
            "name": "request_id",
            "in": "query",
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-f]{16}$"
            }
          },
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "method",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status_code",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "path",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_from",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "date_to",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SystemLogListResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/system-logs/{id}": {
      "get": {
        "tags": [
          "Admin",
          "Logs"
        ],
        "summary": "系统日志详情",
        "description": "根据ID返回单条 system_log，包含请求与响应截断数据、错误信息、server_meta。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SystemLogDetailResponse"
                }
              }
            }
          },
          "404": {
            "description": "未找到",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/messages/broadcast": {
      "post": {
        "tags": [
          "Admin",
          "Message"
        ],
        "summary": "广播系统消息（带邮件通知）",
        "description": "向所有或筛选后的用户发送系统公告。支持SMTP高优先级邮件抄送。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BroadcastMessageRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "发送完成",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BroadcastMessageResponse"
                }
              }
            }
          },
          "400": {
            "description": "参数缺失"
          },
          "403": {
            "description": "Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "parameters": []
      }
    },
    "/admin/messages/broadcasts": {
      "get": {
        "tags": [
          "Admin",
          "Message"
        ],
        "summary": "获取广播历史 (管理员)",
        "description": "返回最近发送的广播记录及其投递情况",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 5,
              "maximum": 50
            }
          }
        ],
        "responses": {
          "200": {
            "description": "查询成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BroadcastHistoryResponse"
                }
              }
            }
          },
          "403": {
            "description": "Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/users/{id}/points/adjust": {
      "post": {
        "tags": [
          "Admin",
          "User"
        ],
        "summary": "调整用户积分",
        "description": "管理员增减指定用户积分。amount 正数增加，负数减少。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdjustUserPointsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "调整成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdjustUserPointsResponse"
                }
              }
            }
          },
          "400": {
            "description": "参数错误"
          },
          "404": {
            "description": "用户不存在"
          }
        }
      }
    },
    "/schools/{id}/classes": {
      "get": {
        "tags": [
          "School"
        ],
        "summary": "获取学校班级列表",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      },
      "post": {
        "tags": [
          "School"
        ],
        "summary": "创建班级",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateClassRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "创建成功"
          }
        }
      }
    },
    "/admin/carbon-activities/pending": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Track"
        ],
        "summary": "待审核碳记录列表 (别名)",
        "description": "等同 /admin/activities 返回结构。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminCarbonRecordsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/carbon-records": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Track"
        ],
        "summary": "待审核碳记录列表 (别名)",
        "description": "等同 /admin/activities 返回结构。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminCarbonRecordsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/multipart/init": {
      "post": {
        "tags": [
          "Files"
        ],
        "summary": "初始化分片上传",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MultipartInitRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MultipartInitResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/multipart/part": {
      "get": {
        "tags": [
          "Files"
        ],
        "summary": "获取分片上传URL",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "file_path",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "upload_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "part_number",
            "in": "query",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MultipartPartResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/multipart/complete": {
      "post": {
        "tags": [
          "Files"
        ],
        "summary": "完成分片上传",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MultipartCompleteRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MultipartCompleteResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/multipart/abort": {
      "post": {
        "tags": [
          "Files"
        ],
        "summary": "取消分片上传",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MultipartAbortRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "已取消"
          }
        }
      }
    },
    "/files/r2/diagnostics": {
      "get": {
        "tags": [
          "Files"
        ],
        "summary": "R2 诊断信息",
        "description": "返回允许的MIME、扩展、最大文件配置等。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/R2DiagnosticsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/carbon-activities": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "获取碳活动列表 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      },
      "post": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "创建碳活动 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCarbonActivityRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "创建成功"
          }
        }
      }
    },
    "/admin/carbon-activities/statistics": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "获取碳活动统计 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/carbon-activities/sort-orders": {
      "put": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "更新活动排序 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/carbon-activities/{id}": {
      "put": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "更新碳活动 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCarbonActivityRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      },
      "delete": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "删除碳活动 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/carbon-activities/{id}/restore": {
      "post": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "恢复碳活动 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/carbon-activities/{id}/statistics": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "获取单个活动统计 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/activities/{id}/review": {
      "put": {
        "tags": [
          "Admin",
          "Carbon Track"
        ],
        "summary": "审核碳记录 (别名)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "status"
                ],
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "approved",
                      "rejected"
                    ]
                  },
                  "admin_notes": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "审核成功"
          },
          "404": {
            "description": "记录不存在"
          }
        }
      }
    },
    "/": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "健康检查",
        "description": "返回API运行状态。",
        "responses": {
          "200": {
            "description": "服务运行中"
          }
        }
      }
    },
    "/{routes}": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "未匹配路由 (GET)",
        "description": "通配未匹配的路由，返回404。",
        "responses": {
          "404": {
            "description": "Route not found"
          }
        }
      },
      "post": {
        "tags": [
          "System"
        ],
        "summary": "未匹配路由 (POST)",
        "responses": {
          "404": {
            "description": "Route not found"
          }
        }
      },
      "put": {
        "tags": [
          "System"
        ],
        "summary": "未匹配路由 (PUT)",
        "responses": {
          "404": {
            "description": "Route not found"
          }
        }
      },
      "delete": {
        "tags": [
          "System"
        ],
        "summary": "未匹配路由 (DELETE)",
        "responses": {
          "404": {
            "description": "Route not found"
          }
        }
      },
      "patch": {
        "tags": [
          "System"
        ],
        "summary": "未匹配路由 (PATCH)",
        "responses": {
          "404": {
            "description": "Route not found"
          }
        }
      }
    },
    "/carbon-track/factors": {
      "get": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "获取碳因子配置",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-track/stats": {
      "get": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "获取用户碳统计",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserStatsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/badges": {
      "get": {
        "tags": [
          "Badges"
        ],
        "summary": "List achievement badges",
        "description": "获取平台成就徽章列表。普通用户默认只返回启用状态的徽章，管理员可通过查询参数查看全部。",
        "parameters": [
          {
            "name": "include_inactive",
            "in": "query",
            "schema": {
              "type": "boolean"
            },
            "description": "管理员可设置为 true 查看未启用的徽章"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BadgeListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/badges/auto-trigger": {
      "post": {
        "tags": [
          "Badges"
        ],
        "summary": "Trigger automatic badge grant",
        "description": "管理员触发自动授予流程，按照配置规则为符合条件的用户授予徽章。",
        "responses": {
          "200": {
            "description": "Trigger executed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BadgeAutoTriggerResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/users/me/badges": {
      "get": {
        "tags": [
          "Badges"
        ],
        "summary": "List badges for current user",
        "description": "返回当前登录用户已获得或被收回的成就徽章。",
        "parameters": [
          {
            "name": "include_revoked",
            "in": "query",
            "schema": {
              "type": "boolean"
            },
            "description": "设置为 true 时返回已收回的徽章"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserBadgeListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/admin/badges": {
      "get": {
        "tags": [
          "Admin - Badges"
        ],
        "summary": "List badges (admin)",
        "parameters": [
          {
            "name": "include_inactive",
            "in": "query",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BadgeListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "post": {
        "tags": [
          "Admin - Badges"
        ],
        "summary": "Create badge",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateBadgeRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Badge created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BadgeResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/admin/badges/{id}": {
      "get": {
        "tags": [
          "Admin - Badges"
        ],
        "summary": "Get badge detail",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BadgeResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "Admin - Badges"
        ],
        "summary": "Update badge",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateBadgeRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Badge updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BadgeResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/admin/badges/{id}/award": {
      "post": {
        "tags": [
          "Admin - Badges"
        ],
        "summary": "Award badge to user",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BadgeAwardRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Badge awarded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BadgeResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/admin/badges/{id}/revoke": {
      "post": {
        "tags": [
          "Admin - Badges"
        ],
        "summary": "Revoke badge from user",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BadgeAwardRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Badge revoked",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BadgeResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/admin/badges/auto-trigger": {
      "post": {
        "tags": [
          "Admin - Badges"
        ],
        "summary": "Trigger auto grant (admin)",
        "description": "手动执行徽章自动授予流程。",
        "responses": {
          "200": {
            "description": "Trigger executed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BadgeAutoTriggerResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/admin/badges/{id}/recipients": {
      "get": {
        "summary": "List badge recipients",
        "tags": [
          "Admin - Badges"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "awarded",
                "revoked",
                "all"
              ]
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "include_revoked",
            "in": "query",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Badge recipients returned",
            "content": {
              "application/json": {
                "schema": {
                  "": "#/components/schemas/BadgeRecipientsResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not found"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/admin/users/{id}/overview": {
      "get": {
        "summary": "Get user overview with metrics",
        "tags": [
          "Admin - Users"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User overview returned",
            "content": {
              "application/json": {
                "schema": {
                  "": "#/components/schemas/AdminUserOverviewResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not found"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/admin/users/{id}/badges": {
      "get": {
        "summary": "List badges for a specific user (admin)",
        "tags": [
          "Admin - Users"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "include_revoked",
            "in": "query",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User badge list returned",
            "content": {
              "application/json": {
                "schema": {
                  "": "#/components/schemas/AdminUserBadgesResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not found"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/admin/messages/broadcast/recipients": {
      "get": {
        "tags": [
          "Admin",
          "Message"
        ],
        "summary": "搜索广播收件人",
        "description": "提供按关键字、学校、邮箱后缀等条件筛选广播目标用户的接口。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "fields",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "逗号分隔的搜索字段"
          },
          {
            "name": "school",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "school_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "email_suffix",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "is_admin",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 5,
              "maximum": 200
            }
          }
        ],
        "responses": {
          "200": {
            "description": "查询成功",
            "content": {
              "application/json": {
                "schema": {
                  "": "#/components/schemas/BroadcastRecipientSearchResponse"
                }
              }
            }
          },
          "403": {
            "description": "Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "FilePresignRequest": {
        "type": "object",
        "required": [
          "original_name",
          "mime_type"
        ],
        "properties": {
          "original_name": {
            "type": "string"
          },
          "mime_type": {
            "type": "string"
          },
          "file_size": {
            "type": "integer",
            "description": "可选-前端声明大小, 单位字节"
          },
          "directory": {
            "type": "string",
            "default": "uploads"
          },
          "sha256": {
            "type": "string",
            "description": "文件内容SHA256(64 hex)用于去重"
          },
          "entity_type": {
            "type": "string"
          },
          "entity_id": {
            "type": "integer"
          },
          "expires_in": {
            "type": "integer",
            "default": 600
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "message": {
            "type": "string",
            "example": "错误描述"
          },
          "code": {
            "type": "string",
            "example": "错误代码"
          },
          "request_id": {
            "type": "string",
            "nullable": true,
            "description": "请求ID，若反馈问题请附带此值。16位小写十六进制。",
            "pattern": "^[0-9a-f]{16}$",
            "example": "d4c1ab09ef23aa7b"
          },
          "error": {
            "type": "string",
            "description": "旧接口错误字段（部分控制器仍返回）"
          }
        },
        "description": "统一错误响应结构；所有4xx/5xx响应都会包含 request_id。"
      },
      "RegisterRequest": {
        "type": "object",
        "required": [
          "username",
          "email",
          "password",
          "confirm_password"
        ],
        "properties": {
          "username": {
            "type": "string",
            "minLength": 3,
            "maxLength": 50,
            "pattern": "^[a-zA-Z0-9_]+$",
            "description": "用户名，只能包含字母、数字和下划线"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "有效的邮箱地址"
          },
          "password": {
            "type": "string",
            "format": "password",
            "description": "密码，至少8个字符"
          },
          "confirm_password": {
            "type": "string",
            "format": "password",
            "description": "确认密码"
          },
          "school_id": {
            "type": "integer",
            "minimum": 1,
            "description": "已存在学校ID；与 new_school_name 互斥且优先生效"
          },
          "new_school_name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 255,
            "description": "当用户找不到所属学校时可直接输入新名称，将在注册事务内自动创建（若不存在，忽略大小写匹配）；若同时提供 school_id 与 new_school_name，则使用 school_id 并忽略 new_school_name"
          },
          "cf_turnstile_response": {
            "type": "string",
            "description": "Cloudflare Turnstile验证令牌（某些部署可选）"
          }
        },
        "description": "注册请求。允许通过 new_school_name 在注册时一次性创建新学校。优先级：若提供 school_id 则忽略 new_school_name。系统在创建前会执行不区分大小写的名称查重以避免重复。"
      },
      "RegisterSuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string",
            "example": "User registered successfully"
          },
          "data": {
            "type": "object",
            "properties": {
              "user": {
                "type": "object",
                "properties": {
                  "id": { "type": "integer" },
                  "username": { "type": "string" },
                  "email": { "type": "string", "format": "email" },
                  "points": { "type": "number" },
                  "is_admin": { "type": "boolean" },
                  "email_verified_at": { "type": "string", "format": "date-time", "nullable": true }
                }
              },
              "token": { "type": "string" },
              "email_verification_required": { "type": "boolean" },
              "email_verification_sent": { "type": "boolean" },
              "verification_expires_at": { "type": "string", "format": "date-time", "nullable": true },
              "verification_resend_available_at": { "type": "string", "format": "date-time", "nullable": true }
            }
          }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": [
          "email",
          "password",
          "cf_turnstile_response"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "用户邮箱"
          },
          "password": {
            "type": "string",
            "format": "password",
            "description": "用户密码"
          },
          "cf_turnstile_response": {
            "type": "string",
            "description": "Cloudflare Turnstile验证令牌"
          }
        }
      },
      "LoginSuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true,
            "description": "请求是否成功"
          },
          "message": {
            "type": "string",
            "example": "Login successful",
            "description": "响应消息"
          },
          "data": {
            "type": "object",
            "properties": {
              "token": {
                "type": "string",
                "description": "登录JWT令牌"
              },
              "user": {
                "$ref": "#/components/schemas/UserResponse"
              },
              "email_verification_required": {
                "type": "boolean",
                "nullable": true,
                "description": "当前登录会话是否需要邮箱验证"
              },
              "email_verification_sent": {
                "type": "boolean",
                "nullable": true,
                "description": "本次登录流程是否已成功排入验证邮件异步发送队列"
              },
              "verification_expires_at": {
                "type": "string",
                "format": "date-time",
                "nullable": true,
                "description": "当前有效的验证代码过期时间"
              },
              "verification_resend_available_at": {
                "type": "string",
                "format": "date-time",
                "nullable": true,
                "description": "下次允许重新发送验证邮件的时间（若受限）"
              },
              "email_verification_rate_limited": {
                "type": "boolean",
                "nullable": true,
                "description": "是否因频率限制而未发送新的验证邮件"
              }
            }
          }
        }
      },
      "UserResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "用户ID"
          },
          "uuid": {
            "type": "string",
            "format": "uuid",
            "nullable": true,
            "description": "用户UUID"
          },
          "username": {
            "type": "string",
            "description": "用户名"
          },
          "email": {
            "type": "string",
            "description": "邮箱地址"
          },
          "school_id": {
            "type": "integer",
            "nullable": true,
            "description": "所属学校ID"
          },
          "school_name": {
            "type": "string",
            "nullable": true,
            "description": "所属学校名称"
          },
          "points": {
            "type": "number",
            "description": "当前积分余额"
          },
          "is_admin": {
            "type": "boolean",
            "description": "是否为管理员"
          },
          "avatar_id": {
            "type": "integer",
            "nullable": true,
            "description": "头像ID"
          },
          "avatar_url": {
            "type": "string",
            "nullable": true,
            "description": "头像URL"
          },
          "lastlgn": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "description": "最近登录时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "description": "账户更新时间"
          },
          "badges_awarded": {
            "type": "integer",
            "description": "已授予徽章记录数"
          },
          "badges_revoked": {
            "type": "integer",
            "description": "已收回徽章记录数"
          },
          "active_badges": {
            "type": "integer",
            "description": "当前激活徽章数量"
          },
          "total_carbon_saved": {
            "type": "number",
            "description": "累计碳减排量"
          },
          "total_transactions": {
            "type": "integer",
            "description": "累计积分记录数"
          },
          "earned_points": {
            "type": "number",
            "description": "累计获取积分"
          },
          "last_badge_awarded_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time",
            "description": "最近授予徽章时间"
          },
          "days_since_registration": {
            "type": "integer",
            "description": "注册天数"
          }
        }
      },
      "UpdateProfileRequest": {
        "type": "object",
        "properties": {
          "school_id": {
            "type": "integer",
            "minimum": 1,
            "description": "学校ID"
          },
          "avatar_id": {
            "type": "integer",
            "description": "头像ID"
          }
        }
      },
      "CalculateRequest": {
        "type": "object",
        "required": [
          "activity_id",
          "amount"
        ],
        "properties": {
          "activity_id": {
            "type": "string",
            "description": "活动ID (UUID)"
          },
          "amount": {
            "type": "number",
            "minimum": 0,
            "description": "本次计算使用的数值。旧客户端可能发送字段 data，服务端会自动兼容。"
          },
          "data": {
            "type": "number",
            "minimum": 0,
            "description": "旧字段，等同于 amount。发送时任一字段即可。"
          },
          "unit": {
            "type": "string",
            "description": "可选，覆盖活动默认单位"
          }
        }
      },
      "CalculateResponse": {
        "type": "object",
        "properties": {
          "carbon_saved": {
            "type": "number",
            "description": "计算得到的碳减排量（kg CO₂）"
          },
          "points_earned": {
            "type": "integer",
            "description": "根据碳减排量换算得到的积分"
          },
          "carbon_factor": {
            "type": "number",
            "description": "活动对应的碳减排因子"
          },
          "unit": {
            "type": "string",
            "description": "计算使用的单位"
          }
        }
      },
      "SubmitRecordRequest": {
        "type": "object",
        "required": [
          "activity_id",
          "amount",
          "date"
        ],
        "properties": {
          "activity_id": {
            "type": "string",
            "description": "活动ID (UUID)"
          },
          "amount": {
            "type": "number",
            "minimum": 0,
            "description": "本次记录的实际数值"
          },
          "date": {
            "type": "string",
            "format": "date",
            "description": "活动发生日期"
          },
          "description": {
            "type": "string",
            "nullable": true,
            "description": "备注信息"
          },
          "unit": {
            "type": "string",
            "nullable": true,
            "description": "可选，覆盖活动默认单位"
          },
          "images": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ImageObject"
            },
            "description": "图片数组。/api/v1/carbon-records 需至少一张；/carbon-track/record 可为空以兼容旧版。",
            "default": []
          }
        }
      },
      "SubmitRecordResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          },
          "calculation": {
            "type": "object",
            "properties": {
              "carbon_saved": {
                "type": "number"
              },
              "points_earned": {
                "type": "integer"
              }
            }
          },
          "data": {
            "type": "object",
            "properties": {
              "record_id": {
                "type": "string"
              },
              "carbon_saved": {
                "type": "number"
              },
              "points_earned": {
                "type": "integer"
              },
              "status": {
                "type": "string",
                "enum": [
                  "pending",
                  "approved",
                  "rejected"
                ]
              },
              "images": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ImageObject"
                },
                "default": []
              },
              "monthly_achievements": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/MonthlyAchievement"
                },
                "default": []
              }
            }
          }
        }
      },
      "ImageObject": {
        "type": "object",
        "description": "标准化的图片对象。某些早期返回可能仅包含 url。",
        "properties": {
          "url": {
            "type": "string",
            "description": "可访问的图片URL"
          },
          "file_path": {
            "type": "string",
            "description": "服务器或对象存储中的内部路径",
            "nullable": true
          },
          "original_name": {
            "type": "string",
            "description": "原始文件名",
            "nullable": true
          },
          "mime_type": {
            "type": "string",
            "description": "MIME类型",
            "nullable": true
          },
          "size": {
            "type": "integer",
            "description": "文件大小(字节)",
            "nullable": true
          }
        },
        "required": [
          "url"
        ]
      },
      "MonthlyAchievement": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "成就名称"
          },
          "points": {
            "type": "integer",
            "description": "该成就获得的积分"
          }
        },
        "required": [
          "name",
          "points"
        ]
      },
      "PointsHistoryResponse": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer",
            "description": "当前页码"
          },
          "limit": {
            "type": "integer",
            "description": "每页数量"
          },
          "total": {
            "type": "integer",
            "description": "总记录数"
          },
          "records": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "description": "记录ID"
                },
                "user_id": {
                  "type": "integer",
                  "description": "用户ID"
                },
                "activity_id": {
                  "type": "string",
                  "description": "活动ID"
                },
                "carbon_saved": {
                  "type": "number",
                  "description": "碳减排量"
                },
                "points_awarded": {
                  "type": "integer",
                  "description": "奖励积分"
                },
                "status": {
                  "type": "string",
                  "enum": [
                    "pending",
                    "approved",
                    "rejected"
                  ],
                  "description": "记录状态"
                },
                "images": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ImageObject"
                  },
                  "description": "图片数组（可能为空）",
                  "default": []
                },
                "created_at": {
                  "type": "string",
                  "format": "date-time",
                  "description": "记录创建时间"
                },
                "updated_at": {
                  "type": "string",
                  "format": "date-time",
                  "description": "记录更新时间"
                }
              }
            }
          }
        }
      },
    "UserStatsResponse": {
      "type": "object",
      "required": [
        "success",
        "data"
      ],
        "properties": {
          "success": {
            "type": "boolean",
            "description": "请求是否成功"
          },
          "data": {
            "type": "object",
            "required": [
              "current_points",
              "total_points",
              "total_carbon_saved",
              "total_activities",
              "total_earned"
            ],
            "properties": {
              "current_points": {
                "type": "integer",
                "description": "当前账户积分"
              },
              "total_points": {
                "type": "number",
                "description": "当前账户积分（浮点表示）"
              },
              "total_carbon_saved": {
                "type": "number",
                "description": "累计减排量（kg CO2e）"
              },
              "total_activities": {
                "type": "integer",
                "description": "累计提交的活动次数"
              },
              "approved_activities": {
                "type": "integer",
                "description": "已审批通过的活动次数",
                "nullable": true
              },
              "pending_activities": {
                "type": "integer",
                "description": "待审核的活动次数",
                "nullable": true
              },
              "rejected_activities": {
                "type": "integer",
                "description": "已驳回的活动次数",
                "nullable": true
              },
              "total_earned": {
                "type": "number",
                "description": "累计获得的积分总和"
              },
              "rank": {
                "type": "integer",
                "description": "积分排行榜中的当前名次，若无法计算则为 null",
                "nullable": true
              },
              "total_users": {
                "type": "integer",
                "description": "系统中参与排行的总用户数",
                "nullable": true
              },
              "points_change": {
                "type": "number",
                "description": "积分环比变化（百分比）",
                "nullable": true
              },
              "carbon_change": {
                "type": "number",
                "description": "减排量环比变化（百分比）",
                "nullable": true
              },
              "activities_change": {
                "type": "number",
                "description": "活动次数环比变化（百分比）",
                "nullable": true
              },
              "rank_change": {
                "type": "number",
                "description": "排名变化（正数表示下降）",
                "nullable": true
              },
              "unread_messages": {
                "type": "integer",
                "description": "未读消息数量",
                "nullable": true
              },
              "pending_reviews": {
                "type": "integer",
                "description": "待审核记录数量（占位字段）",
                "nullable": true
              },
              "available_products": {
                "type": "integer",
                "description": "可兑换商品数量（占位字段）",
                "nullable": true
              },
              "new_achievements": {
                "type": "integer",
                "description": "新增成就数量（占位字段）",
                "nullable": true
              },
              "monthly_achievements": {
                "type": "array",
                "description": "按月份统计的积分与减排成就",
                "items": {
                  "type": "object",
                  "properties": {
                    "month": {
                      "type": "string",
                      "description": "月份标识，格式 YYYY-MM"
                    },
                    "label": {
                      "type": "string",
                      "description": "根据语言环境格式化后的月份名称",
                      "nullable": true
                    },
                    "points": {
                      "type": "number",
                      "description": "当月获取的积分"
                    },
                    "carbon": {
                      "type": "number",
                      "description": "当月减排量"
                    },
                    "records": {
                      "type": "integer",
                      "description": "当月记录数量"
                    }
                  }
                }
              },
              "leaderboard": {
                "type": "array",
                "description": "积分排行榜前几名",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer",
                      "nullable": true
                    },
                    "username": {
                      "type": "string",
                      "nullable": true
                    },
                    "total_points": {
                      "type": "number",
                      "description": "排行榜用户的累计积分"
                    },
                    "avatar_id": {
                      "type": "integer",
                      "nullable": true
                    },
                    "avatar_path": {
                      "type": "string",
                      "nullable": true
                    },
                    "avatar_url": {
                      "type": "string",
                      "nullable": true,
                      "description": "头像访问 URL（若可用）"
                    }
                  }
                }
              },
              "member_since": {
                "type": "string",
                "format": "date-time",
                "description": "用户注册时间",
                "nullable": true
              }
            }
          }
        }
      },
      "ChartDataResponse": {
        "type": "object",
        "properties": {
          "labels": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "X轴标签（日期）"
          },
          "datasets": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "label": {
                  "type": "string",
                  "description": "数据集标签"
                },
                "data": {
                  "type": "array",
                  "items": {
                    "type": "number"
                  },
                  "description": "Y轴数据（碳减排量或积分）"
                },
                "backgroundColor": {
                  "type": "string",
                  "description": "背景色"
                },
                "borderColor": {
                  "type": "string",
                  "description": "边框色"
                },
                "borderWidth": {
                  "type": "integer",
                  "description": "边框宽度"
                }
              }
            }
          }
        }
      },
      "RecentActivitiesResponse": {
        "type": "object",
        "description": "Recent activities summary used on the dashboard.",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer",
                  "description": "Activity record ID"
                },
                "activity_id": {
                  "type": "integer",
                  "nullable": true
                },
                "activity_name_zh": {
                  "type": "string",
                  "nullable": true
                },
                "activity_name_en": {
                  "type": "string",
                  "nullable": true
                },
                "category": {
                  "type": "string",
                  "nullable": true
                },
                "unit": {
                  "type": "string",
                  "nullable": true
                },
                "data": {
                  "type": "number",
                  "description": "Submitted activity amount"
                },
                "carbon_saved": {
                  "type": "number",
                  "nullable": true
                },
                "points_earned": {
                  "type": "number",
                  "nullable": true
                },
                "status": {
                  "type": "string",
                  "enum": [
                    "pending",
                    "approved",
                    "rejected"
                  ]
                },
                "created_at": {
                  "type": "string",
                  "format": "date-time"
                },
                "images": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RecentActivityImage"
                  }
                }
              },
              "required": [
                "id",
                "data",
                "status",
                "created_at",
                "images"
              ]
            }
          }
        },
        "required": [
          "success",
          "data"
        ]
      },
      "AdminCarbonRecordsResponse": {
        "type": "object",
        "description": "管理员审核列表数据结构，包含直接可用的 images.url (已在后端填充 public_url 或回退 file_path 生成)。",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "data": {
            "type": "object",
            "properties": {
              "records": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "user_id": {
                      "type": "integer"
                    },
                    "username": {
                      "type": "string"
                    },
                    "activity_id": {
                      "type": "string"
                    },
                    "activity_name": {
                      "type": "string"
                    },
                    "category": {
                      "type": "string"
                    },
                    "carbon_saved": {
                      "type": "number"
                    },
                    "points_earned": {
                      "type": "integer"
                    },
                    "status": {
                      "type": "string"
                    },
                    "created_at": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "images": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/ImageObject"
                      },
                      "default": []
                    }
                  }
                }
              },
              "pagination": {
                "type": "object",
                "properties": {
                  "page": {
                    "type": "integer"
                  },
                  "limit": {
                    "type": "integer"
                  },
                  "total": {
                    "type": "integer"
                  },
                  "pages": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        }
      },
      "AvatarsResponse": {
        "type": "object",
        "properties": {
          "avatars": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer",
                  "description": "头像ID"
                },
                "uuid": {
                  "type": "string",
                  "description": "头像UUID"
                },
                "name": {
                  "type": "string",
                  "description": "头像名称"
                },
                "description": {
                  "type": "string",
                  "description": "头像描述（可选）"
                },
                "category": {
                  "type": "string",
                  "description": "头像类别"
                },
                "file_path": {
                  "type": "string",
                  "description": "R2 文件路径"
                },
                "icon_path": {
                  "type": "string",
                  "description": "图标路径（去除前缀）"
                },
                "icon_url": {
                  "type": "string",
                  "description": "图标的公开URL"
                },
                "icon_presigned_url": {
                  "type": "string",
                  "description": "图标的临时签名URL"
                },
                "image_url": {
                  "type": "string",
                  "description": "前端统一使用的图片地址"
                },
                "url": {
                  "type": "string",
                  "description": "图标URL（与icon_url相同）"
                },
                "thumbnail_path": {
                  "type": "string",
                  "description": "缩略图路径"
                },
                "thumbnail_url": {
                  "type": "string",
                  "description": "缩略图URL"
                },
                "sort_order": {
                  "type": "integer",
                  "description": "排序值"
                },
                "is_active": {
                  "type": "boolean",
                  "description": "是否有效"
                },
                "is_default": {
                  "type": "boolean",
                  "description": "是否为默认头像"
                }
              }
            }
          }
        }
      },
      "AvatarCategoriesResponse": {
        "type": "object",
        "properties": {
          "categories": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer",
                  "description": "类别ID"
                },
                "name": {
                  "type": "string",
                  "description": "类别名称"
                },
                "description": {
                  "type": "string",
                  "description": "类别描述"
                },
                "avatar_count": {
                  "type": "integer",
                  "description": "包含的头像数量"
                }
              }
            }
          }
        }
      },
      "CarbonActivitiesResponse": {
        "type": "object",
        "properties": {
          "grouped": {
            "type": "boolean",
            "description": "是否按类别分组"
          },
          "total": {
            "type": "integer",
            "description": "活动总数"
          },
          "categories": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "activities": {
            "type": "array",
            "items": {
              "anyOf": [
                {
                  "$ref": "#/components/schemas/CarbonActivityResponse"
                },
                {
                  "$ref": "#/components/schemas/CarbonActivityGroup"
                }
              ]
            }
          }
        }
      },
      "CarbonActivityResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "活动ID"
          },
          "name_zh": {
            "type": "string",
            "description": "中文名称"
          },
          "name_en": {
            "type": "string",
            "description": "英文名称"
          },
          "combined_name": {
            "type": "string",
            "description": "组合名称"
          },
          "category": {
            "type": "string",
            "description": "活动类别"
          },
          "carbon_factor": {
            "type": "number",
            "format": "float",
            "description": "碳减排系数"
          },
          "unit": {
            "type": "string",
            "description": "单位"
          },
          "description_zh": {
            "type": [
              "string",
              "null"
            ],
            "description": "中文描述"
          },
          "description_en": {
            "type": [
              "string",
              "null"
            ],
            "description": "英文描述"
          },
          "icon": {
            "type": [
              "string",
              "null"
            ],
            "description": "图标"
          },
          "is_active": {
            "type": "boolean",
            "description": "是否启用"
          },
          "sort_order": {
            "type": "integer",
            "description": "排序值"
          },
          "statistics": {
            "$ref": "#/components/schemas/CarbonActivityStatistics"
          },
          "created_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time",
            "description": "更新时间"
          },
          "deleted_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time",
            "description": "删除时间"
          }
        }
      },
      "ProductsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "products": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Product"
                }
              },
              "pagination": {
                "type": "object",
                "properties": {
                  "page": {
                    "type": "integer"
                  },
                  "limit": {
                    "type": "integer"
                  },
                  "total": {
                    "type": "integer"
                  },
                  "pages": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        }
      },
      "ProductResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "$ref": "#/components/schemas/Product"
          }
        }
      },
      "Product": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "points_required": {
            "type": "integer"
          },
          "price": {
            "type": "integer",
            "description": "向后兼容字段，等同于 points_required"
          },
          "stock": {
            "type": "integer",
            "minimum": -1
          },
          "category": {
            "type": "string",
            "nullable": true,
            "description": "Category display name"
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive"
            ]
          },
          "image_path": {
            "type": "string"
          },
          "image_url": {
            "type": "string"
          },
          "images": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "file_path": {
                  "type": "string"
                },
                "url": {
                  "type": "string"
                },
                "public_url": {
                  "type": "string"
                }
              }
            }
          },
          "tags": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProductTag"
            }
          },
          "is_available": {
            "type": "boolean"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          },
          "category_slug": {
            "type": "string",
            "description": "Canonical category slug",
            "nullable": true
          }
        }
      },
      "CreateProductRequest": {
        "type": "object",
        "required": [
          "name",
          "points_required",
          "stock"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "points_required": {
            "type": "integer",
            "minimum": 0
          },
          "stock": {
            "type": "integer",
            "minimum": -1
          },
          "category": {
            "oneOf": [
              {
                "type": "string",
                "description": "Existing category name or slug",
                "nullable": true
              },
              {
                "$ref": "#/components/schemas/ProductCategoryInput"
              }
            ],
            "description": "Category reference; pass a string slug/name or structured object",
            "nullable": true
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive"
            ],
            "default": "active"
          },
          "sort_order": {
            "type": "integer",
            "default": 0
          },
          "image_path": {
            "type": "string"
          },
          "image_url": {
            "type": "string"
          },
          "images": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "file_path": {
                  "type": "string"
                },
                "url": {
                  "type": "string"
                }
              }
            }
          },
          "tags": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProductTagInput"
            }
          }
        }
      },
      "UpdateProductRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "points_required": {
            "type": "integer",
            "minimum": 0
          },
          "stock": {
            "type": "integer",
            "minimum": -1
          },
          "category": {
            "oneOf": [
              {
                "type": "string",
                "description": "Existing category name or slug",
                "nullable": true
              },
              {
                "$ref": "#/components/schemas/ProductCategoryInput"
              }
            ],
            "description": "Category reference; pass a string slug/name or structured object",
            "nullable": true
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive"
            ]
          },
          "sort_order": {
            "type": "integer"
          },
          "image_path": {
            "type": "string"
          },
          "image_url": {
            "type": "string"
          },
          "images": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "file_path": {
                  "type": "string"
                },
                "url": {
                  "type": "string"
                }
              }
            }
          },
          "tags": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProductTagInput"
            }
          }
        }
      },
      "ProductTag": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "nullable": true
          },
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          }
        }
      },
      "ProductTagInput": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "nullable": true
          },
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          }
        }
      },
      "ProductTagListResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "tags": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ProductTag"
                }
              }
            }
          }
        }
      },
      "ExchangeRequest": {
        "type": "object",
        "required": [
          "product_id",
          "quantity"
        ],
        "properties": {
          "product_id": {
            "type": "integer",
            "description": "产品ID"
          },
          "quantity": {
            "type": "integer",
            "minimum": 1,
            "description": "兑换数量"
          },
          "delivery_address": {
            "type": "string",
            "description": "收货地址；虚拟商品请填写邮箱（默认使用账号邮箱）",
            "example": "user@example.com"
          },
          "contact_area_code": {
            "type": "string",
            "description": "联系电话区号（与联系电话配套填写）",
            "example": "+86"
          },
          "contact_phone": {
            "type": "string",
            "description": "联系电话，可选。如为虚拟商品可留空",
            "example": "13800138000"
          },
          "notes": {
            "type": "string",
            "description": "备注信息，可选",
            "example": "请在周末派送"
          }
        }
      },
      "ExchangeResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "message": {
            "type": "string"
          },
          "exchange_id": {
            "type": "string",
            "format": "uuid"
          },
          "points_used": {
            "type": "integer"
          },
          "remaining_points": {
            "type": "integer"
          }
        }
      },
      "ExchangeTransactionsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "format": "uuid"
                },
                "user_id": {
                  "type": "integer"
                },
                "username": {
                  "type": "string"
                },
                "product_id": {
                  "type": "integer"
                },
                "product_name": {
                  "type": "string"
                },
                "quantity": {
                  "type": "integer"
                },
                "points_used": {
                  "type": "integer"
                },
                "status": {
                  "type": "string"
                },
                "created_at": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          },
          "pagination": {
            "type": "object",
            "properties": {
              "page": {
                "type": "integer"
              },
              "limit": {
                "type": "integer"
              },
              "total": {
                "type": "integer"
              },
              "pages": {
                "type": "integer"
              }
            }
          }
        }
      },
      "ExchangeTransactionResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "format": "uuid"
              },
              "user_id": {
                "type": "integer"
              },
              "username": {
                "type": "string"
              },
              "product_id": {
                "type": "integer"
              },
              "product_name": {
                "type": "string"
              },
              "quantity": {
                "type": "integer"
              },
              "points_used": {
                "type": "integer"
              },
              "status": {
                "type": "string"
              },
              "created_at": {
                "type": "string",
                "format": "date-time"
              },
              "updated_at": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        }
      },
      "CreateCarbonActivityRequest": {
        "type": "object",
        "required": [
          "name_zh",
          "name_en",
          "category",
          "carbon_factor",
          "unit"
        ],
        "properties": {
          "name_zh": {
            "type": "string"
          },
          "name_en": {
            "type": "string"
          },
          "category": {
            "type": "string"
          },
          "carbon_factor": {
            "type": "number"
          },
          "unit": {
            "type": "string"
          },
          "description_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "description_en": {
            "type": [
              "string",
              "null"
            ]
          },
          "icon": {
            "type": [
              "string",
              "null"
            ]
          },
          "is_active": {
            "type": "boolean"
          },
          "sort_order": {
            "type": "integer"
          }
        }
      },
      "UpdateCarbonActivityRequest": {
        "type": "object",
        "properties": {
          "name_zh": {
            "type": "string"
          },
          "name_en": {
            "type": "string"
          },
          "category": {
            "type": "string"
          },
          "carbon_factor": {
            "type": "number"
          },
          "unit": {
            "type": "string"
          },
          "description_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "description_en": {
            "type": [
              "string",
              "null"
            ]
          },
          "icon": {
            "type": [
              "string",
              "null"
            ]
          },
          "is_active": {
            "type": "boolean"
          },
          "sort_order": {
            "type": "integer"
          }
        }
      },
      "CreateAvatarRequest": {
        "type": "object",
        "required": [
          "name",
          "file_path",
          "thumbnail_path",
          "category"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "file_path": {
            "type": "string"
          },
          "thumbnail_path": {
            "type": "string"
          },
          "category": {
            "type": "string"
          },
          "sort_order": {
            "type": "integer"
          },
          "is_active": {
            "type": "boolean"
          },
          "is_default": {
            "type": "boolean"
          }
        }
      },
      "AvatarResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer"
              },
              "uuid": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "file_path": {
                "type": "string"
              },
              "icon_path": {
                "type": "string"
              },
              "icon_url": {
                "type": "string"
              },
              "icon_presigned_url": {
                "type": "string"
              },
              "image_url": {
                "type": "string"
              },
              "url": {
                "type": "string"
              },
              "thumbnail_path": {
                "type": "string"
              },
              "thumbnail_url": {
                "type": "string"
              },
              "category": {
                "type": "string"
              },
              "sort_order": {
                "type": "integer"
              },
              "is_active": {
                "type": "boolean"
              },
              "is_default": {
                "type": "boolean"
              }
            }
          }
        }
      },
      "UnifiedLogSearchResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "data": {
            "type": "object",
            "properties": {
              "system": {
                "type": "object",
                "properties": {
                  "count": {
                    "type": "integer"
                  },
                  "page": {
                    "type": "integer"
                  },
                  "pages": {
                    "type": "integer"
                  },
                  "limit": {
                    "type": "integer"
                  },
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "method": {
                          "type": "string"
                        },
                        "path": {
                          "type": "string"
                        },
                        "status_code": {
                          "type": "integer"
                        },
                        "user_id": {
                          "type": "integer",
                          "nullable": true
                        },
                        "duration_ms": {
                          "type": "integer"
                        },
                        "request_id": {
                          "type": "string"
                        },
                        "created_at": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              },
              "audit": {
                "type": "object",
                "properties": {
                  "count": {
                    "type": "integer"
                  },
                  "page": {
                    "type": "integer"
                  },
                  "pages": {
                    "type": "integer"
                  },
                  "limit": {
                    "type": "integer"
                  },
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "action": {
                          "type": "string"
                        },
                        "operation_category": {
                          "type": "string",
                          "nullable": true
                        },
                        "actor_type": {
                          "type": "string"
                        },
                        "status": {
                          "type": "string"
                        },
                        "user_id": {
                          "type": "integer",
                          "nullable": true
                        },
                        "ip_address": {
                          "type": "string",
                          "nullable": true
                        },
                        "created_at": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              },
              "error": {
                "type": "object",
                "properties": {
                  "count": {
                    "type": "integer"
                  },
                  "page": {
                    "type": "integer"
                  },
                  "pages": {
                    "type": "integer"
                  },
                  "limit": {
                    "type": "integer"
                  },
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "error_type": {
                          "type": "string"
                        },
                        "error_message": {
                          "type": "string"
                        },
                        "error_file": {
                          "type": "string",
                          "nullable": true
                        },
                        "error_line": {
                          "type": "integer",
                          "nullable": true
                        },
                        "error_time": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "RelatedLogsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "data": {
            "type": "object",
            "properties": {
              "request_id": {
                "type": "string"
              },
              "audit": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "action": {
                      "type": "string"
                    },
                    "operation_category": {
                      "type": "string",
                      "nullable": true
                    },
                    "actor_type": {
                      "type": "string"
                    },
                    "status": {
                      "type": "string"
                    },
                    "user_id": {
                      "type": "integer",
                      "nullable": true
                    },
                    "ip_address": {
                      "type": "string",
                      "nullable": true
                    },
                    "created_at": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              },
              "error": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "error_type": {
                      "type": "string"
                    },
                    "error_message": {
                      "type": "string"
                    },
                    "error_file": {
                      "type": "string",
                      "nullable": true
                    },
                    "error_line": {
                      "type": "integer",
                      "nullable": true
                    },
                    "error_time": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "UpdateAvatarRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "file_path": {
            "type": "string"
          },
          "thumbnail_path": {
            "type": "string"
          },
          "category": {
            "type": "string"
          },
          "sort_order": {
            "type": "integer"
          },
          "is_active": {
            "type": "boolean"
          },
          "is_default": {
            "type": "boolean"
          }
        }
      },
      "securitySchemes": {
        "bearerAuth": {
          "type": "http",
          "scheme": "bearer",
          "bearerFormat": "JWT",
          "description": "JWT认证，格式为'Bearer {token}'"
        }
      },
      "AchievementBadge": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "uuid": {
            "type": "string",
            "format": "uuid"
          },
          "code": {
            "type": [
              "string",
              "null"
            ]
          },
          "name_zh": {
            "type": "string"
          },
          "name_en": {
            "type": "string"
          },
          "description_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "description_en": {
            "type": [
              "string",
              "null"
            ]
          },
          "icon_path": {
            "type": "string"
          },
          "icon_thumbnail_path": {
            "type": [
              "string",
              "null"
            ]
          },
          "icon_url": {
            "type": [
              "string",
              "null"
            ],
            "format": "uri"
          },
          "icon_thumbnail_url": {
            "type": [
              "string",
              "null"
            ],
            "format": "uri"
          },
          "icon_presigned_url": {
            "type": [
              "string",
              "null"
            ],
            "format": "uri"
          },
          "is_active": {
            "type": "boolean"
          },
          "is_default": {
            "type": [
              "boolean",
              "null"
            ]
          },
          "sort_order": {
            "type": "integer"
          },
          "auto_grant_enabled": {
            "type": "boolean"
          },
          "auto_grant_criteria": {
            "type": [
              "object",
              "null"
            ],
            "description": "JSON 结构的自动授予规则"
          },
          "message_title_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_title_en": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_body_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_body_en": {
            "type": [
              "string",
              "null"
            ]
          },
          "created_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "updated_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          }
        }
      },
      "UserBadgeRecord": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "badge_id": {
            "type": "integer"
          },
          "user_id": {
            "type": "integer"
          },
          "status": {
            "type": "string",
            "enum": [
              "awarded",
              "revoked"
            ]
          },
          "awarded_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "awarded_by": {
            "type": [
              "integer",
              "null"
            ]
          },
          "revoked_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "revoked_by": {
            "type": [
              "integer",
              "null"
            ]
          },
          "source": {
            "type": "string",
            "enum": [
              "manual",
              "auto",
              "trigger"
            ]
          },
          "notes": {
            "type": [
              "string",
              "null"
            ]
          },
          "meta": {
            "type": [
              "object",
              "null"
            ]
          }
        }
      },
      "BadgeListResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "": "#/components/schemas/AdminBadgeSummary"
            }
          }
        }
      },
      "BadgeResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "": "#/components/schemas/AdminBadgeDetail"
          }
        }
      },
      "UserBadgeListResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "badge": {
                  "$ref": "#/components/schemas/AchievementBadge"
                },
                "user_badge": {
                  "$ref": "#/components/schemas/UserBadgeRecord"
                }
              }
            }
          }
        }
      },
      "BadgeAutoTriggerResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "awarded": {
                "type": "integer"
              },
              "skipped": {
                "type": "integer"
              },
              "badges": {
                "type": "integer"
              },
              "users": {
                "type": "integer"
              }
            }
          }
        }
      },
      "CreateBadgeRequest": {
        "type": "object",
        "required": [
          "name_zh",
          "name_en",
          "icon_path"
        ],
        "properties": {
          "name_zh": {
            "type": "string"
          },
          "name_en": {
            "type": "string"
          },
          "description_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "description_en": {
            "type": [
              "string",
              "null"
            ]
          },
          "icon_path": {
            "type": "string"
          },
          "icon_thumbnail_path": {
            "type": [
              "string",
              "null"
            ]
          },
          "sort_order": {
            "type": "integer"
          },
          "is_active": {
            "type": "boolean"
          },
          "auto_grant_enabled": {
            "type": "boolean"
          },
          "auto_grant_criteria": {
            "type": [
              "object",
              "null"
            ]
          },
          "message_title_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_title_en": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_body_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_body_en": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "UpdateBadgeRequest": {
        "type": "object",
        "required": [
          "name_zh",
          "name_en",
          "icon_path"
        ],
        "properties": {
          "name_zh": {
            "type": "string"
          },
          "name_en": {
            "type": "string"
          },
          "description_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "description_en": {
            "type": [
              "string",
              "null"
            ]
          },
          "icon_path": {
            "type": "string"
          },
          "icon_thumbnail_path": {
            "type": [
              "string",
              "null"
            ]
          },
          "sort_order": {
            "type": "integer"
          },
          "is_active": {
            "type": "boolean"
          },
          "auto_grant_enabled": {
            "type": "boolean"
          },
          "auto_grant_criteria": {
            "type": [
              "object",
              "null"
            ]
          },
          "message_title_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_title_en": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_body_zh": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_body_en": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "BadgeAwardRequest": {
        "type": "object",
        "required": [
          "user_id"
        ],
        "properties": {
          "user_id": {
            "type": "integer"
          },
          "notes": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "CarbonActivityStatistics": {
        "type": "object",
        "description": "Aggregated metrics for a carbon activity",
        "additionalProperties": true
      },
      "CarbonActivityGroup": {
        "type": "object",
        "properties": {
          "category": {
            "type": "string",
            "description": "活动类别"
          },
          "count": {
            "type": "integer",
            "description": "该分类下活动数量"
          },
          "activities": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CarbonActivityResponse"
            }
          }
        }
      },
      "BadgeStats": {
        "type": "object",
        "properties": {
          "total_records": {
            "type": "integer"
          },
          "unique_users": {
            "type": "integer"
          },
          "awarded_records": {
            "type": "integer"
          },
          "revoked_records": {
            "type": "integer"
          },
          "awarded_users": {
            "type": "integer"
          },
          "last_awarded_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          }
        }
      },
      "BadgeRecipientUser": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "username": {
            "type": [
              "string",
              "null"
            ]
          },
          "email": {
            "type": [
              "string",
              "null"
            ]
          },
          "is_admin": {
            "type": [
              "boolean",
              "null"
            ]
          },
          "status": {
            "type": [
              "string",
              "null"
            ]
          },
          "avatar_id": {
            "type": [
              "integer",
              "null"
            ]
          }
        }
      },
      "BadgeRecipientItem": {
        "type": "object",
        "properties": {
          "user": {
            "anyOf": [
              {
                "type": "null"
              },
              {
                "": "#/components/schemas/BadgeRecipientUser"
              }
            ]
          },
          "user_badge": {
            "": "#/components/schemas/UserBadgeRecord"
          }
        }
      },
      "BadgeSummary": {
        "type": "object",
        "properties": {
          "awarded": {
            "type": "integer"
          },
          "revoked": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          }
        }
      },
      "UserMetricsSnapshot": {
        "type": "object",
        "properties": {
          "total_carbon_saved": {
            "type": "number"
          },
          "total_points_earned": {
            "type": "number"
          },
          "total_approved_records": {
            "type": "integer"
          },
          "total_records": {
            "type": "integer"
          },
          "total_points_balance": {
            "type": "number"
          },
          "days_since_registration": {
            "type": "integer"
          }
        }
      },
      "AdminBadgeSummary": {
        "allOf": [
          {
            "": "#/components/schemas/AchievementBadge"
          },
          {
            "type": "object",
            "properties": {
              "stats": {
                "": "#/components/schemas/BadgeStats"
              }
            }
          }
        ]
      },
      "AdminBadgeDetail": {
        "allOf": [
          {
            "": "#/components/schemas/AdminBadgeSummary"
          },
          {
            "type": "object",
            "properties": {
              "recent_awards": {
                "type": "array",
                "items": {
                  "": "#/components/schemas/BadgeRecipientItem"
                }
              },
              "recent_awards_pagination": {
                "type": "object",
                "properties": {
                  "current_page": {
                    "type": "integer"
                  },
                  "per_page": {
                    "type": "integer"
                  },
                  "total_items": {
                    "type": "integer"
                  },
                  "total_pages": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        ]
      },
      "BadgeRecipientsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "items": {
                "type": "array",
                "items": {
                  "": "#/components/schemas/BadgeRecipientItem"
                }
              },
              "pagination": {
                "type": "object",
                "properties": {
                  "current_page": {
                    "type": "integer"
                  },
                  "per_page": {
                    "type": "integer"
                  },
                  "total_items": {
                    "type": "integer"
                  },
                  "total_pages": {
                    "type": "integer"
                  }
                }
              },
              "badge": {
                "anyOf": [
                  {
                    "type": "null"
                  },
                  {
                    "": "#/components/schemas/AdminBadgeSummary"
                  }
                ]
              }
            }
          }
        }
      },
      "AdminUserBadgesResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "badges": {
                "type": "array",
                "items": {
                  "": "#/components/schemas/BadgeRecipientItem"
                }
              },
              "summary": {
                "": "#/components/schemas/BadgeSummary"
              },
              "metrics": {
                "": "#/components/schemas/UserMetricsSnapshot"
              },
              "items": {
                "type": "array",
                "items": {
                  "": "#/components/schemas/BadgeRecipientItem"
                }
              }
            }
          }
        }
      },
      "AdminUserOverviewResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "properties": {
              "user": {
                "": "#/components/schemas/UserResponse"
              },
              "metrics": {
                "": "#/components/schemas/UserMetricsSnapshot"
              },
              "badge_summary": {
                "": "#/components/schemas/BadgeSummary"
              },
              "recent_badges": {
                "type": "array",
                "items": {
                  "": "#/components/schemas/BadgeRecipientItem"
                }
              }
            }
          }
        }
      },
      "BroadcastMessageRequest": {
        "type": "object",
        "required": [
          "title",
          "content"
        ],
        "properties": {
          "title": {
            "type": "string",
            "maxLength": 255,
            "description": "Message title displayed to recipients"
          },
          "content": {
            "type": "string",
            "description": "Message body text"
          },
          "priority": {
            "type": "string",
            "enum": [
              "low",
              "normal",
              "high",
              "urgent"
            ],
            "default": "normal"
          },
          "target_users": {
            "type": "array",
            "items": {
              "type": "integer",
              "minimum": 1
            },
            "description": "Optional user id whitelist; omit to broadcast to all users"
          },
          "target_filters": {
            "type": "array",
            "description": "Advanced recipient filter groups. Each entry is merged with explicit target_users.",
            "items": {
              "": "#/components/schemas/BroadcastRecipientFilter"
            }
          }
        }
      },
      "BroadcastMessageResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "sent_count": {
            "type": "integer"
          },
          "total_targets": {
            "type": "integer"
          },
          "failed_user_ids": {
            "type": "array",
            "items": {
              "type": "integer"
            }
          },
          "invalid_user_ids": {
            "type": "array",
            "items": {
              "type": "integer"
            }
          },
          "message": {
            "type": "string"
          },
          "priority": {
            "type": "string",
            "enum": [
              "low",
              "normal",
              "high",
              "urgent"
            ]
          },
          "scope": {
            "type": "string",
            "enum": [
              "all",
              "custom"
            ]
          },
          "message_ids": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "description": "Sample of message IDs created for this broadcast."
          },
          "message_id_count": {
            "type": "integer",
            "description": "Total number of messages created for this broadcast."
          },
          "email_delivery": {
            "$ref": "#/components/schemas/BroadcastEmailDelivery",
            "description": "高优先级广播的邮件发送统计信息。"
          }
        },
        "required": [
          "success",
          "sent_count",
          "total_targets"
        ],
        "description": "广播发送结果。包含站内信与邮件发送状态。"
      },
      "BroadcastUserEntry": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": [
              "integer",
              "null"
            ]
          },
          "username": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_id": {
            "type": [
              "integer",
              "null"
            ]
          },
          "read": {
            "type": "boolean"
          }
        }
      },
      "BroadcastHistoryItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "actor_user_id": {
            "type": [
              "integer",
              "null"
            ]
          },
          "title": {
            "type": "string"
          },
          "content": {
            "type": "string"
          },
          "priority": {
            "type": "string",
            "enum": [
              "low",
              "normal",
              "high",
              "urgent"
            ]
          },
          "scope": {
            "type": "string",
            "enum": [
              "all",
              "custom"
            ]
          },
          "target_count": {
            "type": "integer"
          },
          "sent_count": {
            "type": "integer"
          },
          "read_count": {
            "type": "integer"
          },
          "unread_count": {
            "type": "integer"
          },
          "invalid_user_ids": {
            "type": "array",
            "items": {
              "type": "integer"
            }
          },
          "failed_user_ids": {
            "type": "array",
            "items": {
              "type": "integer"
            }
          },
          "read_users": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BroadcastUserEntry"
            }
          },
          "unread_users": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BroadcastUserEntry"
            }
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "message_ids": {
            "type": "array",
            "items": {
              "type": "integer"
            }
          },
          "message_id_count": {
            "type": "integer"
          },
          "message_id_map": {
            "type": "object",
            "additionalProperties": {
              "type": "integer"
            },
            "description": "Maps user IDs to message IDs created during the broadcast."
          },
          "actor_username": {
            "type": [
              "string",
              "null"
            ],
            "description": "执行广播的管理员用户名。"
          },
          "email_delivery": {
            "$ref": "#/components/schemas/BroadcastEmailDelivery",
            "description": "邮件投递统计信息。"
          }
        },
        "description": "历史广播记录条目。包含收件统计与邮件投递信息。"
      },
      "BroadcastHistoryResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BroadcastHistoryItem"
            }
          },
          "pagination": {
            "type": "object",
            "properties": {
              "page": {
                "type": "integer"
              },
              "limit": {
                "type": "integer"
              },
              "total": {
                "type": "integer"
              },
              "pages": {
                "type": "integer"
              }
            }
          }
        }
      },
      "RecentActivityImage": {
        "type": "object",
        "description": "Proof image metadata including optional presigned download URL.",
        "properties": {
          "url": {
            "type": "string",
            "format": "uri",
            "nullable": true
          },
          "file_path": {
            "type": "string",
            "nullable": true
          },
          "original_name": {
            "type": "string",
            "nullable": true
          },
          "mime_type": {
            "type": "string",
            "nullable": true
          },
          "size": {
            "type": "integer",
            "nullable": true
          },
          "presigned_url": {
            "type": "string",
            "format": "uri",
            "nullable": true
          },
          "thumbnail_path": {
            "type": "string",
            "nullable": true
          }
        }
      },
      "BroadcastRecipientFilter": {
        "type": "object",
        "description": "Advanced filter options for selecting broadcast recipients.",
        "properties": {
          "search": {
            "type": "string",
            "description": "Free text search applied to selected fields."
          },
          "fields": {
            "description": "Fields to search against (username, email, school, location, school_name).",
            "oneOf": [
              {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              {
                "type": "string"
              }
            ]
          },
          "school": {
            "type": "string"
          },
          "school_id": {
            "type": "integer",
            "minimum": 1
          },
          "email_suffix": {
            "type": "string",
            "description": "Email suffix to match (e.g. example.com)."
          },
          "email_domain": {
            "type": "string",
            "description": "Alias for email_suffix."
          },
          "status": {
            "type": "string"
          },
          "is_admin": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "integer",
                "enum": [
                  0,
                  1
                ]
              },
              {
                "type": "string",
                "enum": [
                  "0",
                  "1",
                  "true",
                  "false"
                ]
              }
            ]
          },
          "exclude_ids": {
            "type": "array",
            "description": "User ids to exclude from the filter result.",
            "items": {
              "type": "integer",
              "minimum": 1
            }
          },
          "limit": {
            "type": "integer",
            "minimum": 10,
            "maximum": 500
          }
        }
      },
      "BroadcastEmailDelivery": {
        "type": "object",
        "properties": {
          "triggered": {
            "type": "boolean",
            "description": "Whether SMTP sending was attempted."
          },
          "attempted_recipients": {
            "type": "integer",
            "description": "Total recipients with valid email addresses."
          },
          "successful_chunks": {
            "type": "integer",
            "description": "Number of BCC batches successfully sent."
          },
          "failed_chunks": {
            "type": "integer",
            "description": "Number of BCC batches that failed."
          },
          "failed_recipient_ids": {
            "type": "array",
            "items": {
              "type": "integer"
            }
          },
          "missing_email_user_ids": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "description": "Recipients that could not be emailed due to missing email addresses."
          },
          "status": {
            "type": "string",
            "enum": [
              "skipped",
              "sent",
              "partial",
              "queued",
              "failed"
            ],
            "description": "High-level delivery status for SMTP dispatch, including queued when deferred for asynchronous processing."
          },
          "errors": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Diagnostic messages when delivery was skipped or failed."
          }
        }
      },
      "BroadcastRecipient": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "username": {
            "type": [
              "string",
              "null"
            ]
          },
          "email": {
            "type": [
              "string",
              "null"
            ]
          },
          "school": {
            "type": [
              "string",
              "null"
            ]
          },
          "school_id": {
            "type": [
              "integer",
              "null"
            ]
          },
          "location": {
            "type": [
              "string",
              "null"
            ]
          },
          "is_admin": {
            "type": [
              "boolean",
              "null"
            ]
          },
          "status": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "BroadcastRecipientSearchResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "": "#/components/schemas/BroadcastRecipient"
            }
          },
          "pagination": {
            "type": "object",
            "properties": {
              "page": {
                "type": "integer"
              },
              "limit": {
                "type": "integer"
              },
              "has_more": {
                "type": "boolean"
              }
            }
          }
        }
      },
      "ProductCategoryInput": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "nullable": true,
            "description": "Existing category identifier"
          },
          "name": {
            "type": "string",
            "description": "Category display name"
          },
          "slug": {
            "type": "string",
            "description": "URL-friendly category slug"
          }
        },
        "additionalProperties": false
      },
      "ProductCategorySummary": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "nullable": true
          },
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          },
          "product_count": {
            "type": "integer",
            "minimum": 0
          }
        },
        "required": [
          "name",
          "slug",
          "product_count"
        ],
        "additionalProperties": false
      }
    },
    "/messages": {
      "get": {
        "tags": [
          "Message"
        ],
        "summary": "获取用户消息列表",
        "description": "获取当前认证用户的消息列表。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "is_read",
            "in": "query",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取消息列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer"
                          },
                          "title": {
                            "type": "string"
                          },
                          "content": {
                            "type": "string"
                          },
                          "is_read": {
                            "type": "boolean"
                          },
                          "created_at": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "NotificationPreference": {
      "type": "object",
      "required": [
        "category",
        "label",
        "locked",
        "email_enabled"
      ],
      "properties": {
        "category": {
          "type": "string",
          "description": "通知类别标识"
        },
        "label": {
          "type": "string",
          "description": "通知类别名称"
        },
        "locked": {
          "type": "boolean",
          "description": "是否为强制开启的通知类别"
        },
        "email_enabled": {
          "type": "boolean",
          "description": "是否通过邮件发送此类通知"
        }
      }
    },
    "NotificationPreferenceUpdateRequest": {
      "type": "object",
      "required": [
        "preferences"
      ],
      "properties": {
        "preferences": {
          "type": "array",
          "description": "需要更新的通知偏好列表，锁定的通知类型将被忽略。",
          "items": {
            "type": "object",
            "required": [
              "category",
              "email_enabled"
            ],
            "properties": {
              "category": {
                "type": "string",
                "description": "通知类别标识"
              },
              "email_enabled": {
                "type": "boolean",
                "description": "是否开启该通知的邮件提醒"
              }
            }
          }
        }
      }
    },
    "NotificationPreferencesResponse": {
      "type": "object",
      "required": [
        "success",
        "data"
      ],
      "properties": {
        "success": {
          "type": "boolean",
          "example": true
        },
        "message": {
          "type": "string",
          "nullable": true
        },
        "data": {
          "type": "object",
          "required": [
            "preferences"
          ],
          "properties": {
            "preferences": {
              "type": "array",
              "items": {
                "$ref": "#/components/schemas/NotificationPreference"
              }
            }
          }
        }
      }
    },
    "NotificationTestEmailRequest": {
      "type": "object",
      "properties": {
        "category": {
          "type": "string",
          "description": "要预览的通知类别，留空时默认使用 system。",
          "enum": [
            "verification",
            "security",
            "system",
            "transaction",
            "activity",
            "announcement",
            "message"
          ]
        }
      }
    },
    "NotificationTestEmailPreview": {
      "type": "object",
      "description": "生成测试邮件时填充模版的数据预览，字段会根据类别变化。",
      "properties": {
        "category": {
          "type": "string",
          "description": "通知类别标识"
        },
        "sample": {
          "type": "object",
          "description": "用于渲染模版的最近数据。如果 generated = true，则表示该数据为测试生成。",
          "properties": {
            "generated": {
              "type": "boolean",
              "description": "是否为自动生成的测试样本"
            }
          },
          "additionalProperties": true,
          "nullable": true
        },
        "code": {
          "type": "string",
          "description": "验证码或临时代码（仅适用于验证相关模板）",
          "nullable": true
        },
        "link": {
          "type": "string",
          "description": "用于预览的测试链接",
          "format": "uri",
          "nullable": true
        },
        "fallback": {
          "type": "boolean",
          "description": "是否使用了兜底模版",
          "nullable": true
        }
      },
      "additionalProperties": true
    },
    "NotificationTestEmailResponse": {
      "type": "object",
      "required": [
        "success",
        "message",
        "data"
      ],
      "properties": {
        "success": {
          "type": "boolean",
          "example": true
        },
        "message": {
          "type": "string",
          "description": "操作提示信息"
        },
        "data": {
          "type": "object",
          "required": [
            "queued",
            "delivered",
            "generated",
            "category"
          ],
          "properties": {
            "queued": {
              "type": "boolean",
              "description": "是否异步排队发送（测试邮件默认同步发送）"
            },
            "delivered": {
              "type": "boolean",
              "description": "邮件是否已发送或已调度执行"
            },
            "generated": {
              "type": "boolean",
              "description": "是否使用了自动生成的示例数据"
            },
            "category": {
              "type": "string",
              "description": "本次预览的通知类别"
            },
            "preview": {
              "allOf": [
                {
                  "$ref": "#/components/schemas/NotificationTestEmailPreview"
                }
              ],
              "nullable": true
            }
          }
        }
      }
    },
    "/messages/{id}": {
      "get": {
        "tags": [
          "Message"
        ],
        "summary": "获取消息详情",
        "description": "获取指定ID的消息详情。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "消息ID"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取消息详情",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "title": {
                          "type": "string"
                        },
                        "content": {
                          "type": "string"
                        },
                        "is_read": {
                          "type": "boolean"
                        },
                        "created_at": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "消息不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Message"
        ],
        "summary": "删除消息",
        "description": "删除指定ID的消息。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "消息ID"
          }
        ],
        "responses": {
          "200": {
            "description": "消息删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "消息不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/messages/{id}/read": {
      "put": {
        "tags": [
          "Message"
        ],
        "summary": "标记消息为已读",
        "description": "将指定ID的消息标记为已读。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "消息ID"
          }
        ],
        "responses": {
          "200": {
            "description": "标记成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "消息不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/messages/unread-count": {
      "get": {
        "tags": [
          "Message"
        ],
        "summary": "获取未读消息数量",
        "description": "获取当前用户的未读消息数量。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取未读数量",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "unread_count": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/exchange": {
      "post": {
        "tags": [
          "Exchange"
        ],
        "summary": "兑换产品",
        "description": "提交兑换请求，从用户积分中扣除，创建兑换记录。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExchangeRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "兑换成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExchangeResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "库存不足或积分不足",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/exchange/transactions": {
      "get": {
        "tags": [
          "Exchange"
        ],
        "summary": "获取用户兑换记录",
        "description": "获取当前认证用户的兑换记录列表。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取兑换记录",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExchangeTransactionsResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/exchange/transactions/{id}": {
      "get": {
        "tags": [
          "Exchange"
        ],
        "summary": "获取兑换记录详情",
        "description": "获取指定ID的兑换记录详情。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "兑换记录ID"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取兑换详情",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExchangeTransactionResponse"
                }
              }
            }
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/products": {
      "get": {
        "tags": [
          "Product"
        ],
        "summary": "获取产品列表",
        "description": "获取可兑换产品列表，支持搜索与分页。",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取产品列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductsResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Product"
        ],
        "summary": "创建产品",
        "description": "创建新产品（如果后端允许公共POST则保留；否则仅管理员，已在 /admin/products 记录）。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateProductRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "创建成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            }
          }
        }
      }
    },
    "/products/{id}": {
      "get": {
        "tags": [
          "Product"
        ],
        "summary": "获取产品详情",
        "description": "获取指定ID的产品详情。",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取产品详情",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            }
          },
          "404": {
            "description": "产品不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Product"
        ],
        "summary": "更新产品",
        "description": "更新指定ID产品（如果允许普通用户；否则仅管理员路径生效）。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateProductRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            }
          },
          "404": {
            "description": "产品不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Product"
        ],
        "summary": "删除产品",
        "description": "删除指定ID产品（如果允许普通用户；否则仅管理员路径生效）。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "删除成功"
          },
          "404": {
            "description": "产品不存在"
          }
        }
      }
    },
    "/products/categories": {
      "get": {
        "tags": [
          "Product"
        ],
        "summary": "获取产品分类",
        "description": "获取所有可用产品分类。",
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/schools": {
      "get": {
        "tags": [
          "School"
        ],
        "summary": "获取学校列表",
        "description": "获取学校列表（公开接口）。",
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer"
                          },
                          "name": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/users": {
      "get": {
        "tags": [
          "Admin",
          "User"
        ],
        "summary": "��ȡ�û��б� (����Ա)",
        "description": "����Ա��ȡ�û��б���֧�ַ�ҳɸѡ��",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "search",
            "in": "query",
            "description": "Fuzzy match on username or email. Alias: q.",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "Filter by account status",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "inactive"
              ]
            }
          },
          {
            "name": "role",
            "in": "query",
            "description": "Convenience filter. When set to admin/user it maps to is_admin=1/0.",
            "schema": {
              "type": "string",
              "enum": [
                "admin",
                "user"
              ]
            }
          },
          {
            "name": "is_admin",
            "in": "query",
            "description": "Explicit admin filter (0 or 1).",
            "schema": {
              "type": "integer",
              "enum": [
                0,
                1
              ]
            }
          },
          {
            "name": "school_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "sort",
            "in": "query",
            "description": "Sort field",
            "schema": {
              "type": "string",
              "enum": [
                "username_asc",
                "username_desc",
                "email_asc",
                "email_desc",
                "points_asc",
                "points_desc",
                "created_at_asc",
                "created_at_desc"
              ],
              "default": "created_at_desc"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "�ɹ�",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "users": {
                          "type": "array",
                          "items": {
                            "": "#/components/schemas/UserResponse"
                          }
                        },
                        "pagination": {
                          "type": "object",
                          "properties": {
                            "current_page": {
                              "type": "integer"
                            },
                            "per_page": {
                              "type": "integer"
                            },
                            "total_items": {
                              "type": "integer"
                            },
                            "total_pages": {
                              "type": "integer"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/users/{id}": {
      "put": {
        "tags": [
          "Admin",
          "User"
        ],
        "summary": "更新用户 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功"
          },
          "404": {
            "description": "用户不存在"
          }
        }
      },
      "delete": {
        "tags": [
          "Admin",
          "User"
        ],
        "summary": "删除用户 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          },
          "404": {
            "description": "用户不存在"
          }
        }
      }
    },
    "/admin/transactions/pending": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Track"
        ],
        "summary": "获取待审核碳记录 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/stats": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "获取后台统计 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/logs": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "获取系统日志 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/carbon-activities": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "获取碳活动列表 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      },
      "post": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "创建碳活动 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCarbonActivityRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "创建成功"
          }
        }
      }
    },
    "/admin/carbon-activities/statistics": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "获取碳活动统计 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/carbon-activities/sort-orders": {
      "put": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "更新活动排序 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/carbon-activities/{id}": {
      "put": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "更新碳活动 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCarbonActivityRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      },
      "delete": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "删除碳活动 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/carbon-activities/{id}/restore": {
      "post": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "恢复碳活动 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/admin/carbon-activities/{id}/statistics": {
      "get": {
        "tags": [
          "Admin",
          "Carbon Activity"
        ],
        "summary": "获取单个活动统计 (管理员)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功"
          }
        }
      }
    },
    "/carbon-track/factors": {
      "get": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "获取碳因子配置",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/carbon-track/stats": {
      "get": {
        "tags": [
          "Carbon Track"
        ],
        "summary": "获取用户碳统计",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserStatsResponse"
                }
              }
            }
          }
        }
      }
    }
  }
}


