# CarbonTrack 网站功能测试计划

本文档旨在为 CarbonTrack 网站提供一份全面的功能测试指南，确保各项功能符合预期，并提升用户体验。测试人员应根据以下列表，对网站的各个模块进行系统性测试。

## 1. 用户认证模块 (Authentication)

### 1.1. 用户注册
- **对应页面:** `/auth/register`
- **功能描述:** 新用户通过此页面创建账户。
- **测试用例:**
    - **TC-AUTH-001 (正向):** 使用有效的、未注册的邮箱、符合要求的密码、用户名和学校信息进行注册。**预期结果:** 注册成功，页面跳转至登录页或邮箱验证提示页。同时，用户邮箱应收到一封标题为“欢迎注册 CarbonTrack，请验证您的邮箱”的邮件，邮件内容包含一个有效的验证链接。
    - **TC-AUTH-001.1 (数据):** 检查数据库 `users` 表，确认新用户信息已正确插入，且 `is_verified` 字段为 `false`。
    - **TC-AUTH-001.5 (安全):** 如果注册页面启用了 Turnstile 人机验证，在不完成验证或验证失败的情况下尝试提交表单。**预期结果:** 表单提交被阻止，并提示“请完成人机验证”。
    - **TC-AUTH-002 (负向):** 使用已经注册过的邮箱进行注册。**预期结果:** 系统提示“该邮箱已被注册”，注册失败。
    - **TC-AUTH-003 (负向):** 提交表单时，部分必填项（如邮箱、密码）为空。**预期结果:** 页面提示“此为必填项”，无法提交。
    - **TC-AUTH-004 (负向):** 输入格式错误的邮箱地址 (例如 `test@test` 或 `test.com`)。**预期结果:** 页面提示“请输入有效的邮箱地址”。
    - **TC-AUTH-005 (负向):** 输入不符合强度要求的密码 (例如 `12345`)。**预期结果:** 页面提示密码强度不足的相关信息。
    - **TC-AUTH-006 (负向):** “确认密码”字段与“密码”字段不一致。**预期结果:** 页面提示“两次输入的密码不一致”。
    - **TC-AUTH-006.5 (幂等性):** 使用相同的 `Idempotency-Key` 请求头，连续两次提交完全相同的注册信息。**预期结果:** 第一次请求成功创建用户，返回 201 或 200。第二次请求应直接返回第一次成功的结果，而不会再次创建用户或报错“邮箱已存在”。

### 1.2. 用户登录
- **对应页面:** `/auth/login`
- **功能描述:** 已注册用户通过此页面登录系统。
- **测试用例:**
    - **TC-AUTH-007 (正向):** 输入正确的邮箱和密码。**预期结果:** 登录成功，页面跳转至用户仪表盘 (`/dashboard`)。
    - **TC-AUTH-007.5 (安全):** 如果登录页面启用了 Turnstile 人机验证，在不完成验证或验证失败的情况下尝试提交表单。**预期结果:** 表单提交被阻止，并提示“请完成人机验证”。
    - **TC-AUTH-008 (负向):** 输入正确的邮箱和错误的密码。**预期结果:** 提示“邮箱或密码错误”，登录失败。
    - **TC-AUTH-009 (负向):** 输入未注册的邮箱地址。**预期结果:** 提示“用户不存在”或“邮箱或密码错误”。
    - **TC-AUTH-010 (负向):** 邮箱或密码字段留空。**预期结果:** 提示字段为必填，无法提交。
    - **TC-AUTH-011 (负向):** 连续多次输入错误密码。**预期结果:** 系统可能会暂时锁定账户或要求输入验证码（若有此安全设计）。

### 1.3. 忘记密码与重置
- **对应页面:** `/auth/forgot-password`, `/reset-password`
- **功能描述:** 用户通过邮箱找回并重置密码。
- **测试用例:**
    - **TC-AUTH-012 (正向):** 在“忘记密码”页面输入已注册的邮箱。**预期结果:** 系统提示已发送重置邮件。用户邮箱应收到一封标题为“重置您的 CarbonTrack 密码”的邮件，内容包含一个有效的、有时效性的重置链接。
    - **TC-AUTH-013 (负向):** 在“忘记密码”页面输入未注册的邮箱。**预期结果:** 系统提示“用户不存在”或出于安全考虑不给出明确提示，但不会发送邮件。
    - **TC-AUTH-014 (正向):** 点击邮件中的重置链接，跳转到重置密码页面，输入新密码并确认。**预期结果:** 密码重置成功，用户可以使用新密码登录。
    - **TC-AUTH-015 (负向):** 访问已失效或已使用过的重置链接。**预期结果:** 页面提示“链接已失效”。

### 1.4. 邮箱验证
- **对应页面:** `/auth/verify-email`
- **功能描述:** 用户通过点击邮件中的链接来验证其邮箱地址。
- **测试用例:**
    - **TC-AUTH-016 (正向):** 新用户注册后，点击收到的验证邮件中的链接。**预期结果:** 邮箱验证成功，页面提示成功信息。数据库中对应用户的 `is_verified` 字段更新为 `true`。
- **TC-AUTH-017 (负向):** 多次点击同一个验证链接。**预期结果:** 第一次点击成功后，后续点击应提示“链接已使用”或“邮箱已验证”。
- **TC-AUTH-018 (速率限制):** 在“忘记密码”或请求验证码页面，在短时间内连续多次提交同一个邮箱。**预期结果:** 系统在几次请求后应返回 `429 Too Many Requests` 错误，并提示“请求过于频繁，请稍后再试”。

### 1.5. 用户登出
- **对应API:** `POST /auth/logout`
- **功能描述:** 用户主动结束当前会话。
- **测试用例:**
    - **TC-AUTH-019 (正向):** 已登录用户点击“登出”按钮。**预期结果:** 登出成功，页面跳转至登录页或首页。浏览器中存储的认证 Token 被清除。
    - **TC-AUTH-020 (安全):** 登出后，使用之前被清除的 Token 尝试访问需要认证的接口（如 `/api/v1/users/me`）。**预期结果:** 请求失败，返回 401 未授权错误。

## 2. 用户中心

### 2.1. 个人资料管理
- **对应页面:** `/profile`
- **功能描述:** 用户查看和编辑自己的个人信息。
- **测试用例:**
    - **TC-PROFILE-001 (正向):** 修改用户名、班级等个人信息并保存。**预期结果:** 保存成功，页面显示更新后的信息。
    - **TC-PROFILE-002 (正向):** 从预设的头像库中选择并更换头像。**预期结果:** 头像更换成功，网站各处（如导航栏）的头像同步更新。
    - **TC-PROFILE-003 (正向):** 修改密码，输入正确的当前密码和符合要求的新密码。**预期结果:** 密码修改成功，用户被要求重新登录。
    - **TC-PROFILE-004 (负向):** 修改密码时，输入的当前密码错误。**预期结果:** 提示“当前密码不正确”。

### 2.2. 碳积分与活动
- **对应页面:** `/dashboard`, `/activities`, `/calculate`
- **功能描述:** 用户记录低碳活动、查看积分历史和活动列表。
- **测试用例:**
    - **TC-ACTIVITY-001 (正向):** 在“记录活动”页面 (`/calculate`)，选择一项活动，填写所有必要信息（如日期、描述）并上传一张符合要求的证明图片（如.jpg, .png，小于2MB）。**预期结果:** 提交成功，页面提示“提交成功，请等待审核”。该活动记录出现在 `/activities` 页面，状态为“待审核”。
    - **TC-ACTIVITY-001.2 (文件上传-负向):** 尝试上传不支持的文件类型（如 .gif, .pdf）或超过大小限制（如 5MB）的图片。**预期结果:** 页面应明确提示“文件格式不支持”或“文件过大”，并阻止提交。
    - **TC-ACTIVITY-001.3 (文件上传-负向):** 在上传过程中断开网络连接。**预期结果:** 页面应显示上传失败的提示，并允许用户重试。
    - **TC-ACTIVITY-001.1 (通知):** 提交成功后，用户应收到一条站内信，标题为“您的碳减排活动已提交审核”。检查 `/messages` 页面，确认收到该消息。检查是否会收到重复的站内信或邮件。
    - **TC-ACTIVITY-002 (负向):** 提交活动记录时，缺少必要的证明材料（若该活动类型强制要求）。**预期结果:** 提交按钮无法点击，或点击后提示“请上传证明材料”。
    - **TC-ACTIVITY-003 (正向):** 在“我的活动”页面 (`/activities`)，查看所有已提交的活动记录及其状态（待审核、已批准、已拒绝）。**预期结果:** 列表正确显示所有记录，包含活动名称、提交日期、状态和获得积分（若已批准）。
    - **TC-ACTIVITY-004 (数据):** 管理员在后台批准一条“待审核”的活动。**预期结果:** 该活动状态在 `/activities` 页面更新为“已批准”。用户的总积分在 `/dashboard` 和导航栏正确增加。积分历史记录中出现一条对应的积分增加明细。
    - **TC-ACTIVITY-004.1 (通知):** 活动被批准后，用户应收到一条站内信和一封邮件，标题为“您的碳减排活动已批准”。内容应包含活动名称和获得的积分。检查通知是否重复。
    - **TC-ACTIVITY-005 (数据):** 管理员在后台拒绝一条“待审核”的活动，并填写拒绝理由。**预期结果:** 该活动状态在 `/activities` 页面更新为“已拒绝”。用户总积分不变。
    - **TC-ACTIVITY-005.1 (通知):** 活动被拒绝后，用户应收到一条站内信和一封邮件，标题为“您的碳减排活动已被拒绝”。内容应包含活动名称和拒绝理由。
    - **TC-ACTIVITY-006 (幂等性):** 快速连续点击提交按钮两次（或使用相同的 `Idempotency-Key` 发送两次请求）。**预期结果:** 系统应只处理一次提交，数据库中只生成一条活动记录，防止重复提交。第二次请求应返回第一次成功处理的结果。

### 2.3. 成就与徽章
- **对应页面:** `/achievements`, `/profile`
- **功能描述:** 用户通过完成特定任务获得徽章，并可以查看和展示。
- **测试用例:**
    - **TC-BADGE-001 (自动授予):** 完成一个徽章的获取条件（例如，首次提交碳减排活动）。**预期结果:** 系统自动授予相应徽章。用户收到一条“恭喜您获得新徽章”的站内信通知。
    - **TC-BADGE-002 (数据):** 在“我的成就”页面 (`/achievements`)，新获得的徽章应被点亮并显示获取日期。
    - **TC-BADGE-003 (负向):** 尝试通过异常操作重复触发同一个自动徽章的获取条件。**预期结果:** 徽章不会被重复授予。
    - **TC-BADGE-004 (后台授予):** 管理员在后台为用户手动授予一个徽章。**预期结果:** 用户获得该徽章，并收到相应的站内信通知。
    - **TC-BADGE-005 (后台撤销):** 管理员在后台撤销用户的一个徽章。**预期结果:** 用户的徽章列表中该徽章变为未获得状态，并收到通知。

### 2.4. 仪表盘与数据统计
- **对应页面:** `/dashboard`
- **功能描述:** 用户查看个人碳减排活动的汇总数据、图表和历史。
- **测试用例:**
    - **TC-DASH-001 (数据展示):** 访问仪表盘，检查总积分、本月积分、减排总量等核心KPI数据是否与后端 `/api/v1/users/me/stats` 返回的数据一致。
    - **TC-DASH-002 (图表渲染):** 检查碳减排趋势图（如按周/月）是否正确渲染。验证图表数据是否与后端 `/api/v1/users/me/chart-data` 返回的数据匹配。
    - **TC-DASH-003 (近期活动):** 检查“近期活动”列表是否正确显示最近提交的几条活动记录，其数据源应为 `/api/v1/users/me/activities`。
    - **TC-DASH-004 (积分历史):** 检查“积分历史”模块是否正确显示最近的积分变动记录，其数据源应为 `/api/v1/users/me/points-history`。

### 2.5. 学校与班级
- **对应页面:** `/profile` (或注册页)
- **功能描述:** 用户可以选择或创建学校和班级。
- **测试用例:**
    - **TC-SCHOOL-001 (搜索学校):** 在注册或个人资料页，输入学校名称关键字，系统应能通过 `/api/v1/schools` 接口模糊查询并返回学校列表。
    - **TC-SCHOOL-002 (选择班级):** 选择一个学校后，班级下拉列表应通过 `/api/v1/schools/{id}/classes` 接口加载并显示该校的所有班级。
    - **TC-SCHOOL-003 (创建新学校):** 如果学校不存在，用户输入新学校名称，系统应能通过 `/api/v1/schools` (POST) 创建新学校。
    - **TC-SCHOOL-004 (创建新班级):** 选择学校后，如果班级不存在，用户输入新班级名称，系统应能通过 `/api/v1/schools/{id}/classes` (POST) 在该学校下创建新班级。

## 3. 积分商城 (Store)
- **对应页面:** `/store`
- **功能描述:** 用户使用碳积分兑换商品。
- **测试用例:**
    - **TC-STORE-001 (正向):** 浏览商品列表，点击进入商品详情页。**预期结果:** 页面布局正常，商品信息（名称、所需积分、库存）显示正确。
    - **TC-STORE-001.5 (筛选与排序):** 在商品列表页，使用标签或分类进行筛选。**预期结果:** 列表应只显示符合筛选条件的商品。测试按积分高低、上架时间等排序功能。
    - **TC-STORE-002 (正向):** 当用户积分充足时，兑换一件商品。在兑换过程中，填写详细的联系信息（如收货地址、电话、区号）。**预期结果:** 兑换成功，页面提示“兑换成功”。用户积分相应扣除。在个人中心的兑换历史中生成一条状态为“处理中”的兑换记录，且联系信息被正确保存。
    - **TC-STORE-002.1 (通知):** 兑换成功后，用户应收到一条站内信和一封邮件，标题为“您的商品兑换成功”。内容包含商品名称和消耗的积分。
    - **TC-STORE-003 (负向):** 当用户积分不足时，尝试兑换一件商品。**预期结果:** 提示“积分不足”，无法兑换，用户积分不变。
    - **TC-STORE-004 (负向):** 尝试兑换库存为 0 的商品。**预期结果:** “兑换”按钮为灰色不可点击状态，或点击后提示“商品库存不足”。
    - **TC-STORE-005 (通知):** 管理员在后台将用户的兑换订单状态从“处理中”更新为“已发货”。**预期结果:** 用户收到一条站内信和邮件通知，标题为“您的兑换商品已发货”。
    - **TC-STORE-006 (边界):** 在网络延迟情况下，快速连续点击“兑换”按钮。**预期结果:** 系统应只处理一次兑换请求，只扣除一次积分，只生成一条兑换记录。
    - **TC-STORE-007 (幂等性):** 使用相同的 `Idempotency-Key` 请求头，连续两次提交同一个商品兑换请求。**预期结果:** 第一次请求成功兑换，扣除积分。第二次请求应直接返回第一次成功的结果，而不会重复扣除积分或报错。

## 4. 消息与通知

### 4.1. 消息中心
- **对应页面:** `/messages`
- **功能描述:** 用户查看、阅读和管理所有收到的站内信。
- **测试用例:**
    - **TC-MSG-001 (正向):** 访问消息中心，未读消息应有特殊标记（如小红点或加粗）。导航栏的未读消息计数应正确显示。
    - **TC-MSG-002 (正向):** 点击一条未读消息进入详情页。**预期结果:** 消息内容显示正确。返回列表后，该消息的未读标记消失，导航栏的未读计数减一。
    - **TC-MSG-003 (正向):** 点击“全部标记为已读”按钮。**预期结果:** 所有未读消息变为已读状态，导航栏未读计数变为 0。
    - **TC-MSG-004 (正向):** 删除一条消息。**预期结果:** 该消息从列表中移除。
    - **TC-MSG-005 (排序):** 检查消息列表是否按“未读”状态和“优先级” (`priority`) 字段正确排序。**预期结果:** 未读的、高优先级的消息应显示在列表顶部。

### 4.2. 通知设置
- **对应页面:** `/settings/notifications`
- **功能描述:** 用户自定义接收哪些类型的邮件通知。
- **测试用例:**
    - **TC-NOTIFY-001 (正向):** 关闭“活动批准”的邮件通知并保存。然后让管理员批准该用户的一项活动。**预期结果:** 用户不会收到活动批准的邮件，但仍会收到站内信。
    - **TC-NOTIFY-002 (正向):** 重新开启“活动批准”的邮件通知并保存。再次让管理员批准一项活动。**预期结果:** 用户会正常收到活动批准的邮件和站内信。
    - **TC-NOTIFY-003 (正向):** 点击“发送测试邮件”按钮。**预期结果:** 用户邮箱应收到一封测试邮件。

## 5. 后台管理系统 (Admin)

### 5.1. 管理员仪表盘
- **对应页面:** `/admin/dashboard`
- **功能描述:** 为管理员提供关键业务指标的概览。
- **测试用例:**
    - **TC-ADMIN-DASH-001 (数据展示):** 访问管理员仪表盘，检查核心统计数据（如待审核活动数、新注册用户数、总交易额等）是否通过 `/api/v1/admin/stats` 接口正确加载并显示。

### 5.2. 用户管理
- **对应页面:** `/admin/users`
- **功能描述:** 管理员管理系统中的所有用户。
- **测试用例:**
    - **TC-ADMIN-001 (正向):** 查看用户列表，并使用搜索功能按用户名或邮箱查找用户。**预期结果:** 列表和搜索功能正常工作。
    - **TC-ADMIN-002 (正向):** 编辑某个用户的个人信息（如用户组、状态）。**预期结果:** 修改成功。
    - **TC-ADMIN-003 (正向):** 手动为用户增加或扣除积分，并填写原因。**预期结果:** 操作成功，用户积分变更。用户的积分历史记录中出现一条对应的调整明细，包含原因。
    - **TC-ADMIN-003.1 (通知):** 积分调整后，用户应收到一条关于积分变更的站内信通知。
    - **TC-ADMIN-003.5 (幂等性):** 使用相同的 `Idempotency-Key` 请求头，连续两次为同一用户提交相同的积分调整操作。**预期结果:** 第一次请求成功调整积分。第二次请求应直接返回第一次成功的结果，而不会重复调整积分。

### 5.3. 活动审核
- **对应页面:** `/admin/activities`
- **功能描述:** 管理员审核用户提交的低碳活动记录。
- **测试用例:**
    - **TC-ADMIN-004 (正向):** 查看“待审核”的活动列表。**预期结果:** 列表正确显示所有待处理的记录。
    - **TC-ADMIN-005 (正向):** 批准一条活动记录。**预期结果:** 该记录状态变为“已批准”，对应用户的积分增加。检查用户是否按预期收到站内信和邮件通知。
    - **TC-ADMIN-006 (正向):** 拒绝一条活动记录，并填写拒绝理由。**预期结果:** 该记录状态变为“已拒绝”，用户积分不变。检查用户是否按预期收到包含拒绝理由的站内信和邮件通知。
    - **TC-ADMIN-006.1 (批量操作):** 在列表页勾选多条“待审核”记录，进行批量批准或批量拒绝。**预期结果:** 所有选中的记录状态都正确更新，对应用户的积分和通知也应正确处理。
    - **TC-ADMIN-006.5 (后台创建):** 管理员在后台为指定用户直接创建一条已批准的碳减排活动记录。**预期结果:** 创建成功，对应用户的积分立即增加，并能在其活动历史中看到该记录。
    - **TC-ADMIN-006.6 (后台编辑):** 管理员编辑一条已存在的活动记录（例如，修改活动描述或获得的积分）。**预期结果:** 修改成功。如果积分发生变化，用户的总积分应相应调整。
    - **TC-ADMIN-006.7 (后台删除):** 管理员删除一条活动记录。**预期结果:** 删除成功。如果被删除的是一条已批准的记录，对应用户的积分应被扣除。
    - **TC-ADMIN-006.8 (审计日志):** 在执行了后台的创建、编辑、删除活动操作后，检查系统审计日志 (`/admin/system-logs`)。**预期结果:** 日志中应包含相应的操作记录，明确记下了是哪位管理员、在何时、对哪个用户的哪条活动记录执行了什么操作。

### 5.4. 商品与兑换管理
- **对应页面:** `/admin/products`, `/admin/exchanges`
- **功能描述:** 管理员管理商城商品和处理用户兑换请求。
- **测试用例:**
    - **TC-ADMIN-007 (正向):** 新增、编辑、删除一个商品。**预期结果:** 操作成功，前端商城页面同步更新。
    - **TC-ADMIN-008 (正向):** 查看用户兑换记录列表。**预期结果:** 列表显示所有兑换请求。
    - **TC-ADMIN-009 (正向):** 将一个“处理中”的兑换请求状态更新为“已发货”或“已完成”。**预期结果:** 状态更新成功。检查用户是否按预期收到关于状态变更的站内信和邮件通知。

### 5.5. 消息广播
- **对应页面:** `/admin/broadcast`
- **功能描述:** 管理员向指定用户或全体用户发送系统广播消息，支持高级收件人筛选。
- **测试用例:**
    - **TC-ADMIN-010 (正向-全体):** 创建一条广播消息，选择“全体用户”并发送。**预期结果:** 系统内所有用户都应在消息中心收到该条广播消息。
    - **TC-ADMIN-011 (正向-自定义ID):** 创建一条广播消息，范围选择“自定义”，在输入框中手动输入一个或多个有效的用户ID，并发送。**预期结果:** 只有ID匹配的用户能收到该消息。
    - **TC-ADMIN-011.1 (高级搜索-筛选):** 在“高级收件人搜索”区域，设置一个或多个筛选条件（如学校包含“交通大学”，用户角色为“管理员”），点击搜索。**预期结果:** 下方列表应只显示符合所有条件的用户。
    - **TC-ADMIN-011.2 (高级搜索-选择):** 从搜索结果中，手动勾选一个或多个用户。**预期结果:** 被选中的用户被添加到一个临时的“已选收件人”列表中。
    - **TC-ADMIN-011.3 (高级搜索-添加筛选组):** 设置筛选条件后，不勾选任何用户，而是点击“添加筛选组到广播”按钮。然后发送广播。**预期结果:** 后端应根据这个筛选条件动态查询所有符合条件的用户，并向他们发送消息。
    - **TC-ADMIN-011.4 (组合目标):** 创建一条广播，既手动输入了几个用户ID，又从高级搜索中勾选了几个用户，还添加了一个筛选组。**预期结果:** 所有这三部分用户（去重后）都应收到广播消息。
    - **TC-ADMIN-011.5 (负向-无效ID):** 在自定义ID输入框中输入无效的ID（如 `abc`, `-1`, `0`）。**预期结果:** 发送前预览或验证时应提示“目标用户ID无效”，无法发送。
    - **TC-ADMIN-012 (数据-历史记录):** 查看广播历史记录。**预期结果:** 列表正确显示所有已发送的广播，包括发送时间、目标群体、内容和各项统计数据（目标数、送达数、已读数等）。
    - **TC-ADMIN-012.1 (历史记录-筛选):** 在历史记录页面，使用顶部的筛选器（如按标题关键字、优先级、范围）进行筛选。**预期结果:** 广播列表应实时更新，只显示符合所有筛选条件的记录。
    - **TC-ADMIN-012.2 (历史记录-统计):** 在进行筛选后，检查页面顶部的统计汇总卡片（总广播数、总目标、总送达等）。**预期结果:** 这些统计数据应根据当前筛选出的结果动态计算并正确显示。
    - **TC-ADMIN-012.3 (历史记录-导出):** 在筛选出部分结果后，点击“导出”按钮。**预期结果:** 系统应下载一个 CSV 文件，其内容应只包含当前筛选出的广播记录，且所有列数据都准确无误。
    - **TC-ADMIN-012.4 (历史记录-邮件队列):** 点击“刷新邮件队列”按钮。**预期结果:** 系统向后端发送请求。如果队列中有待处理的邮件，应提示“成功处理了 N 封邮件”。如果队列为空，应提示“队列中没有待处理的邮件”。
    - **TC-ADMIN-012.5 (历史记录-详情):** 点击任意一条历史记录的“显示详情”按钮。**预期结果:** 展开详细信息区域，应能看到已读和未读用户的具体列表（或部分列表）。

### 5.5.1. 消息广播 (UI/UX 与结果展示)
- **功能描述:** 广播中心的前端交互、预览、结果展示等用户体验细节。
- **测试用例:**
    - **TC-ADMIN-013 (UI-预览):** 在填写完广播内容后，点击“预览”按钮。**预期结果:** 页面下方出现预览面板，面板中显示的标题、内容、优先级等信息应与表单填写完全一致。
    - **TC-ADMIN-013.1 (UI-标题装饰):** 在预览和最终发送时，如果标题不包含“公告”或“Announcement”等关键字，系统应自动在标题前添加 `[Announcement/公告]` 标记。
    - **TC-ADMIN-013.2 (UI-动态范围):** 当发送范围为“全体用户”时，如果管理员开始在“自定义用户ID”输入框中输入内容，发送范围应自动切换为“自定义”。
    - **TC-ADMIN-014 (UI-结果展示):** 发送广播后，页面下方出现结果面板。**预期结果:** 面板应正确显示“已发送”、“总目标”、“失败”和“无效”的数量。
    - **TC-ADMIN-014.1 (UI-失败详情):** 如果发送结果中存在发送失败或无效的用户ID，结果面板中应明确展示这些ID列表。
    - **TC-ADMIN-014.2 (UI-邮件结果):** 如果广播触发了邮件发送，结果面板中应显示邮件投递状态（如已发送、部分失败、已入队），并展示详细的投递统计和错误信息（如有）。
    - **TC-ADMIN-015 (UI-HoverCard):** 在高级收件人搜索结果中，将鼠标悬停在任一用户名上。**预期结果:** 弹出一个浮动卡片，清晰地显示该用户的ID、邮箱、学校等详细信息。

### 5.6. 徽章与头像管理
- **对应页面:** `/admin/badges`, `/admin/avatars`
- **功能描述:** 管理员创建、配置和管理系统中的所有徽章和头像。
- **测试用例:**
    - **TC-ADMIN-013 (正向):** 在徽章管理页面，创建一个新的徽章，定义名称、描述、图标和获取条件。**预期结果:** 创建成功，新徽章出现在徽章列表中。
    - **TC-ADMIN-014 (正向):** 编辑一个现有徽章的信息。**预期结果:** 修改成功。
    - **TC-ADMIN-015 (正向):** 在头像管理页面，上传一个新的头像图片，并设置分类和解锁条件（如所需积分）。**预期结果:** 上传成功，新头像出现在头像库中。
    - **TC-ADMIN-016 (正向):** 调整头像或徽章的排序。**预期结果:** 前端用户侧的显示顺序同步更新。

### 5.7. 系统日志与审计
- **对应页面:** `/admin/system-logs`
- **功能描述:** 管理员查看、搜索和导出系统的关键操作与错误日志。
- **测试用例:**
    - **TC-ADMIN-017 (正向):** 访问系统日志页面，查看最近的API请求记录。点击任一记录，应能通过 `/api/v1/admin/system-logs/{id}` 查看完整的请求和响应详情。
    - **TC-ADMIN-018 (搜索):** 使用高级搜索功能 (`/api/v1/admin/logs/search`)，根据用户ID、IP地址、路由路径、状态码等组合条件进行筛选。**预期结果:** 筛选结果准确无误。
    - **TC-ADMIN-019 (关联日志):** 在日志详情页，点击“相关日志”按钮，系统应能通过 `/api/v1/admin/logs/related` 找到与该请求相关的其他日志（如基于 `request_id`）。
    - **TC-ADMIN-020 (导出):** 执行一次搜索后，点击“导出”按钮 (`/api/v1/admin/logs/export`)。**预期结果:** 系统应能将当前搜索结果导出为 CSV 或 JSON 文件。
    - **TC-ADMIN-021 (错误审计):** 故意触发一个后端错误（例如，通过API发送一个格式错误的请求），然后检查日志中是否记录了该错误。**预期结果:** 错误日志中应包含详细的错误信息、堆栈跟踪和请求上下文。

### 5.8. 后台文件管理
- **对应页面:** `/admin/files` (假设存在)
- **功能描述:** 管理员监控和管理云存储中的文件。
- **测试用例:**
    - **TC-ADMIN-022 (存储统计):** 访问文件管理页面，检查存储统计信息（总大小、文件数量）是否通过 `/api/v1/admin/files/stats` 正确加载。
    - **TC-ADMIN-023 (文件列表):** 查看文件列表，应能分页浏览所有已上传的文件，并显示元数据（如文件名、大小、上传者、上传时间）。
    - **TC-ADMIN-024 (文件清理):** 执行一次“清理过期文件”操作 (`/api/v1/admin/files/cleanup`)。**预期结果:** 操作成功，符合条件的孤立文件被删除。

## 6. 文件上传与管理

- **功能描述:** 系统提供标准、分片等多种文件上传方式，并能生成安全的文件访问链接。
- **测试用例:**
    - **TC-FILE-001 (预签名直传):** 在提交活动记录时，前端应先通过 `/api/v1/files/presign` 获取一个预签名的上传URL，然后将文件直接上传到云存储。
    - **TC-FILE-002 (上传确认):** 文件直传成功后，前端应调用 `/api/v1/files/confirm` 接口，将文件信息与业务记录（如活动记录）进行关联。
    - **TC-FILE-003 (分片上传-初始化):** 对于大文件，前端应调用 `/api/v1/files/multipart/init` 初始化分片上传，并获取一个 `uploadId`。
    - **TC-FILE-004 (分片上传-上传分片):** 前端应能为每个分片调用 `/api/v1/files/multipart/part` 获取签名URL并上传。
    - **TC-FILE-005 (分片上传-完成/中止):** 所有分片上传后，调用 `/api/v1/files/multipart/complete` 合并文件。若中途失败，应能调用 `/api/v1/files/multipart/abort` 中止上传。
    - **TC-FILE-006 (安全访问):** 对于私有文件（如活动证明），前端应通过 `/api/v1/files/{path}/presigned-url` 获取一个有时效性的访问链接来展示图片，而不是直接暴露原始URL。

## 7. 通用UI与错误处理

- **功能描述:** 网站的通用界面元素和全局错误处理机制。
- **测试用例:**
    - **TC-UI-001 (响应式):** 在不同尺寸的设备（桌面、平板、手机）上访问所有主要页面。**预期结果:** 页面布局应能自适应，无明显错位或内容截断。
    - **TC-UI-002 (加载状态):** 在进行数据加载操作时（如进入列表页、提交表单），页面应显示加载指示器（如Spinner）。**预期结果:** 加载动画显示正常，加载完成后消失。
    - **TC-UI-003 (空状态):** 访问一个没有任何数据的列表页面（如新用户的活动列表、消息中心）。**预期结果:** 页面应显示友好的空状态提示，而非空白或错误。
    - **TC-UI-004 (API错误):** 模拟后端API返回500服务器错误。**预期结果:** 前端页面应捕获该错误，并向用户显示一个通用的错误提示（如“操作失败，请稍后重试”），而不是让页面崩溃。
    - **TC-UI-005 (网络中断):** 在应用使用过程中断开网络连接，然后尝试进行需要网络请求的操作。**预期结果:** 应用应提示“网络连接已断开”，并允许用户在网络恢复后重试。
    - **TC-UI-006 (分页):** 在数据量大的列表页（如活动历史、消息中心、后台用户列表），检查分页功能。**预期结果:** 点击“下一页”、“上一页”或页码能正确加载对应页的数据。当处于第一页或最后一页时，“上一页”或“下一页”按钮应被禁用。

## 8. 国际化 (Internationalization)

- **功能描述:** 网站支持多语言切换，为不同地区的用户提供本地化体验。
- **测试用例:**
    - **TC-I18N-001 (语言切换):** 在页面的语言切换器 (Language Switcher) 中，从当前语言（如中文）切换到另一种语言（如英文）。**预期结果:** 整个网站界面的静态文本（如导航栏、按钮、标签）应立即更新为所选语言。URL可能会增加语言前缀（如 `/en/dashboard`）。
    - **TC-I18N-002 (内容翻译):** 切换语言后，检查动态生成的内容，如活动类型、商品名称、系统消息等是否也相应地显示为目标语言。
    - **TC-I18N-003 (默认语言):** 清除浏览器缓存和设置。将浏览器默认语言设置为英文，首次访问网站。**预期结果:** 网站应自动以英文显示。
    - **TC-I18N-004 (数据一致性):** 在一种语言下提交数据（如活动记录），然后切换到另一种语言查看。**预期结果:** 提交的数据本身（如用户输入的描述）不应被翻译，但其周围的UI元素（如状态标签“待审核”）应被翻译。

## 9. 公开页面与排行榜

### 9.1. 公开页面
- **功能描述:** 未登录用户可访问的公开信息页面。
- **测试用例:**
    - **TC-PUBLIC-001 (关于我们):** 访问 `/about-us` 页面。**预期结果:** 页面内容正确加载，布局在桌面和移动设备上均显示正常。
    - **TC-PUBLIC-002 (首页):** 未登录状态下访问首页。**预期结果:** 页面应展示项目介绍、核心功能亮点以及可能的排行榜概览。所有指向需登录功能的链接（如“我的仪表盘”）应引导至登录页面。

### 9.2. 排行榜 (Leaderboard)
- **对应页面:** `/leaderboard` 或 `/dashboard` 内的模块
- **功能描述:** 展示用户或学校的碳积分排名。
- **测试用例:**
    - **TC-LEADERBOARD-001 (数据准确性):** 访问排行榜页面，检查个人积分排名和学校总分排名。**预期结果:** 排名应根据后端 `/api/v1/stats/leaderboard` 返回的数据正确计算和排序。
    - **TC-LEADERBOARD-002 (排名更新):** 完成一项活动并获得积分后，再次访问排行榜。**预期结果:** 用户的个人排名和其所在学校的排名应相应更新（可能是实时或在下个统计周期更新）。
    - **TC-LEADERBOARD-003 (UI交互):** 检查排行榜的UI功能，如分页、切换“个人榜”/“学校榜”、高亮显示当前用户所在行等功能是否正常。
